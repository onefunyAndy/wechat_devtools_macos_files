'use strict';!function(require,directRequire){function a(a,b){a({type:f.SIMULATOR_SET_NAVIGATION_BAR,data:{showRecordWording:b}})}async function b(b,c){let{operationType:d,duration:e,format:f}=c.args;e=e||r,e>r&&(e=r);let l=Date.now(),s=0;return f=f||'aac',new Promise((d)=>{const r=g();navigator.mediaDevices.getUserMedia(p).then((g)=>{m=[];try{n=new MediaRecorder(g,q)}catch(a){return void d({errMsg:`${c.api}:fail ${a}`})}n.onstart=()=>{l=Date.now(),o=setTimeout(()=>{n&&n.stop()},e),r.triggerOnEvent({eventName:'onRecorderStateChange',data:{state:'start'}})},n.onpause=()=>{clearTimeout(o),s=Date.now()-l},n.onresume=()=>{l=Date.now(),o=setTimeout(()=>{n&&n.stop()},e-s)},n.onstop=()=>{clearTimeout(o);const c=new Blob(m,{type:'audio/webm'}),d=Date.now()-l+s,e=new FileReader;e.addEventListener('loadend',()=>{const c=i.getCurrent();let g=e.result||'';const l=g.split(',');l&&l[1]?g=l[1]:console.warn('invalid record data');const{error:m,tempFilePath:o}=h.saveBase64DataToFile(c,g,`.durationTime=${d}.${f}`)||{};n=void 0,r.triggerOnEvent({eventName:'onRecorderStateChange',data:{tempFilePath:o,fileSize:g.length,duration:d,state:'stop'}}),j.display({command:k.DISPLAY_INFO,type:'RECORD_FORMAT_INFO',data:{}}),a(b,!1)}),e.readAsDataURL(c)},n.ondataavailable=(a)=>{a.data&&0<a.data.size&&m.push(a.data)},n.onerror=(c)=>{r.triggerOnEvent({eventName:'onRecorderStateChange',data:{state:'error',errMsg:c.message}}),a(b,!1)},n.start(10),a(b,!0),d({errMsg:`${c.api}:ok`})}).catch((a)=>{d({errMsg:`${c.api}:fail ${a.name}`})})})}async function c(a,b){if(n)n.stop();else return{errMsg:`${b.api}:ok`};return{errMsg:`${b.api}:ok`}}async function d(b,c){const d=g();if(n)n.pause();else return{errMsg:`${c.api}:fail`};return d.triggerOnEvent({eventName:'onRecorderStateChange',data:{state:'pause'}}),a(b,!1),{errMsg:`${c.api}:ok`}}async function e(b,c){if(n)n.resume();else return{errMsg:`${c.api}:fail`};return a(b,!0),{errMsg:`${c.api}:ok`}}const f=require('./0634ee2ebd3e560d9d4804ecc960160f.js'),g=require('./dfd9a72b9ff6078018aa4a64eed949a5.js'),h=require('./f6cbcecf6ed9f533f6a506310d8f07b6.js'),i=require('./3bfffbe88b3d923921f851c0697974fe.js'),j=require('./2dfc6a3df6d6fc51266b293c8420e88b.js'),k=require('./56c390e04c10e91a4aa2a2c19d9a885d.js'),l=require('./common/locales/index.js');let m,n,o;const p={audio:!0},q={mimeType:'audio/webm'},r=600000;module.exports={startRecord:async function(b,c){return new Promise((d)=>{navigator.mediaDevices.getUserMedia(p).then((e)=>{m=[];try{n=new MediaRecorder(e,q)}catch(a){return void d({errMsg:`${c.api}:fail ${a}`})}n.onstop=()=>{const e=new Blob(m,{type:'audio/webm'}),f=new FileReader;f.addEventListener('loadend',()=>{const a=i.getCurrent(),b=h.copyFileDataToTemp(a,f.result,'.silk');d({errMsg:`${c.api}:ok`,tempFilePath:b}),n=void 0}),f.readAsDataURL(e),a(b,!1)},n.ondataavailable=(a)=>{a.data&&0<a.data.size&&m.push(a.data)},clearTimeout(o),o=setTimeout(()=>{n&&n.stop()},60000),n.start(10),a(b,!0)}).catch(()=>{d({errMsg:`${c.api}:fail ${l.config.RECORDING_DEVICE_ERROR}`})})})},stopRecord:c,operateRecorder:async function(a,f){const{operationType:g,duration:h,format:i}=f.args;if('pause'===g)return await d(a,f);return'resume'===g?await e(a,f):'stop'===g?await c(a,f):'start'===g?await b(a,f):{errMsg:`${f.api}:fail illegal operationType`}}}}(require('lazyload'),require);