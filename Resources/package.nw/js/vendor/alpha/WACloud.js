var __cloudSDK__=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./src/index.ts")}({"./node_modules/tslib/tslib.es6.js":function(e,t,r){r.r(t),r.d(t,"__extends",function(){return a}),r.d(t,"__assign",function(){return s}),r.d(t,"__rest",function(){return i}),r.d(t,"__decorate",function(){return o}),r.d(t,"__param",function(){return c}),r.d(t,"__metadata",function(){return u}),r.d(t,"__awaiter",function(){return l}),r.d(t,"__generator",function(){return d}),r.d(t,"__exportStar",function(){return f}),r.d(t,"__values",function(){return _}),r.d(t,"__read",function(){return p}),r.d(t,"__spread",function(){return m}),r.d(t,"__await",function(){return E}),r.d(t,"__asyncGenerator",function(){return b}),r.d(t,"__asyncDelegator",function(){return v}),r.d(t,"__asyncValues",function(){return g}),r.d(t,"__makeTemplateObject",function(){return h}),r.d(t,"__importStar",function(){return C}),r.d(t,"__importDefault",function(){return S});var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function a(e,t){function r(){Object.defineProperty(this,"constructor",{value:e})}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function i(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&(r[n[a]]=e[n[a]])}return r}function o(e,t,r,n){var a,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(i=(s<3?a(i):s>3?a(t,r,i):a(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i}function c(e,t){return function(r,n){t(r,n,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,r,n){return new(r||(r=Promise))(function(a,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function o(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){e.done?a(e.value):new r(function(t){t(e.value)}).then(i,o)}c((n=n.apply(e,t||[])).next())})}function d(e,t){var r,n,a,s,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}function f(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function _(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function p(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,s=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)i.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(a)throw a.error}}return i}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e}function E(e){return this instanceof E?(this.v=e,this):new E(e)}function b(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),s=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(e){a[e]&&(n[e]=function(t){return new Promise(function(r,n){s.push([e,t,r,n])>1||o(e,t)})})}function o(e,t){try{!function(e){e.value instanceof E?Promise.resolve(e.value.v).then(c,u):l(s[0][2],e)}(a[e](t))}catch(e){l(s[0][3],e)}}function c(e){o("next",e)}function u(e){o("throw",e)}function l(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}function v(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,a){t[n]=e[n]?function(t){return(r=!r)?{value:E(e[n](t)),done:"return"===n}:a?a(t):t}:a}}function g(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=_(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,a){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,a,(t=e[r](t)).done,t.value)})}}}function h(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function C(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function S(e){return e&&e.__esModule?e:{default:e}}},"./node_modules/webpack/buildin/global.js":function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},"./src/cloud/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/utils/error.ts"),s=r("./src/utils/type.ts"),i=r("./src/network/tunnel.ts"),o=r("./src/config/app.config.ts"),c=function(){function e(){this.inited=!1,this.services={},this.apiServiceMap={},wx.cloud=this.exportAPI={init:this.init.bind(this)},this.meta={session_id:(+new Date).toString()},this.defaultConfig={},this.appConfig=n.__assign({},o.default),this.apiPermissions={}}return e.prototype.getMetaData=function(){return this.meta},e.prototype.getDefaultConfig=function(){return this.defaultConfig},e.prototype.getOverriddenConfig=function(e){var t=n.__assign({},this.defaultConfig);return Object.assign(t,e),t},e.prototype.getEnv=function(e,t){if(e.env)switch(s.getType(e.env)){case"string":return e.env;case"object":return e.env[t];default:return}},e.prototype.init=function(e){void 0===e&&(e={}),this.inited||(this.inited=!0,this.defaultConfig=e,this.sendInitRequest())},e.prototype.sendInitRequest=function(){var e=this,t=JSON.stringify({trace_user:!1!==this.defaultConfig.traceUser});i.tunnel(i.constructTunnelReq("tcbapi_init",t)).then(function(t){var r=t.data;e.appConfig=n.__assign({},e.appConfig,r.config);for(var a=r.tcb_api_list||[],s=0,i=a.length;s<i;s++)e.apiPermissions[a[s].apiname]=a[s].status}).catch(function(e){console.error("cloud init error: ",e)})},e.prototype.registerService=function(e){this.services[e.name]=e;var t=e.getAPIs();for(var r in t)this.apiServiceMap[r]=e.name,this.registerFunction(r,t[r])},e.prototype.registerFunction=function(e,t){var r=this;this.exportAPI[e]=function(){if(!r.inited)throw new a.CloudSDKError({errMsg:"Cloud API isn't enabled, please call wx.cloud.init first\n请先调用 wx.cloud.init() 完成初始化后再调用其他云 API。init 方法可传入一个对象用于设置默认配置，详见文档。"});return t.apply(this,arguments)}},e}();t.Cloud=c;var u=new c;t.default=u},"./src/config/app.config.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default={db_doc_size_limit:524288,upload_max_file_size:20971520,get_temp_file_url_max_requests:50,call_function_poll_max_retry:10,call_function_max_req_data_size:5242880}},"./src/config/error.config.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_CODE={"-1":"",UNKNOWN_ERROR:-1,"-401001":"api permission denied",SDK_API_PERMISSION_DENIED:-401001,"-401002":"api parameter error",SDK_API_PARAMETER_ERROR:-401002,"-401003":"api parameter type error",SDK_API_PARAMETER_TYPE_ERROR:-401003,"-402001":"circular reference detected",SDK_DATABASE_CIRCULAR_REFERENCE:-402001,"-403001":"max upload file size exceeded",SDK_STORAGE_EXCEED_MAX_UPLOAD_SIZE:-403001,"-403002":"internal server error: empty upload url",SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL:-403002,"-403003":"internal server error: empty download url",SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL:-403003,"-404001":"empty call result",SDK_FUNCTIONS_EMPTY_CALL_RESULT:-404001,"-404002":"empty event id",SDK_FUNCTIONS_EMPTY_EVENT_ID:-404002,"-404003":"empty poll url",SDK_FUNCTIONS_EMPTY_POLL_URL:-404003,"-404004":"empty poll result json",SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON:-404004,"-404005":"exceed max poll retry",SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY:-404005,"-404006":"empty poll result base resp",SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP:-404006,"-404007":"error while waiting for the result",SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL:-404007,"-404008":"error while waiting for the result",SDK_FUNCTIONS_POLL_RESULT_STATUS_CODE_ERROR:-404008,"-404009":"error while waiting for the result",SDK_FUNCTIONS_POLL_ERROR:-404009,"-404010":"result expired",SDK_FUNCTIONS_POLL_RESULT_EXPIRED:-404010,"-404011":"cloud function execution error",SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR:-404011,"-601001":"system error",WX_SYSTEM_ERROR:-601001,"-601002":"system args error",WX_SYSTEM_ARGS_ERROR:-601002,"-601003":"system network error",WX_SYSTEM_NETWORK_ERROR:-601003,"-601004":"api permission denied",WX_API_PERMISSION_DENIED:-601004,"-501001":"resource system error",TCB_RESOURCE_SYSTEM_ERROR:-501001,"-501002":"resource server timeout",TCB_RESOURCE_SERVER_TIMEOUT:-501002,"-501003":"exceed request limit",TCB_EXCEED_REQUEST_LIMIT:-501003,"-501004":"exceed concurrent request limit",TCB_EXCEED_CONCURRENT_REQUEST_LIMIT:-501004,"-501005":"invalid env",TCB_INVALID_ENV:-501005,"-501006":"invalid common parameters",TCB_INVALID_COMMON_PARAM:-501006,"-501007":"invalid parameters",TCB_INVALID_PARAM:-501007,"-501008":"invalid request source",TCB_INVALID_REQUEST_SOURCE:-501008,"-501009":"resource not initialized",TCB_RESOURCE_NOT_INITIALIZED:-501009,"-502001":"database request fail",TCB_DB_REQUEST_FAIL:-502001,"-502002":"database invalid command",TCB_DB_INVALID_COMMAND:-502002,"-502003":"database permission denied",TCB_DB_PERMISSION_DENIED:-502003,"-502004":"database exceed collection limit",TCB_DB_EXCEED_COLLECTION_LIMIT:-502004,"-502005":"database collection not exists",TCB_DB_COLLECTION_NOT_EXISTS:-502005,"-503001":"storage request fail",TCB_STORAGE_REQUEST_FAIL:-503001,"-503002":"storage permission denied",TCB_STORAGE_PERMISSION_DENIED:-503002,"-503003":"storage file not exists",TCB_STORAGE_FILE_NOT_EXISTS:-503003,"-503004":"storage invalid sign parameter",TCB_STORAGE_INVALID_SIGN_PARAM:-503004,"-504001":"functions request fail",TCB_FUNCTIONS_REQUEST_FAIL:-504001,"-504002":"functions execute fail",TCB_FUNCTIONS_EXEC_FAIL:-504002}},"./src/externals/public-lib/appserviceSdk.ts":function(e,t,r){var n,a=r("./src/externals/public-lib/wx.ts");try{wx.downloadFile,n=__appServiceSDK__}catch(e){n={_uploadFileSkipCheckDomain:a.default.uploadFile,_downloadFileSkipCheckDomain:a.default.downloadFile,_requestSkipCheckDomain:a.default.request,_operateWXData:a.default.operateWXData}}e.exports=n},"./src/externals/public-lib/reporter.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,a=r("./src/utils/fail-safe.ts");try{Reporter.surroundThirdByTryCatch,n=Reporter}catch(e){n={surroundThirdByTryCatch:function(e,t){return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return a.tryCatch(function(){try{return e.apply(e,r)}catch(e){throw console.error(e.toString()+"; "+t+"\n"+e.stack),e}},t)}}}}t.default=n},"./src/externals/public-lib/wx.ts":function(e,t,r){(function(e){var r;Object.defineProperty(t,"__esModule",{value:!0});try{wx.uploadFile,r=wx}catch(t){r={uploadFile:jest.fn(),downloadFile:jest.fn(),request:jest.fn(),operateWXData:jest.fn(),getFileInfo:jest.fn()},e.wx=r}t.default=r}).call(this,r("./node_modules/webpack/buildin/global.js"))},"./src/hook/invoke.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/type.ts"),a=r("./src/utils/fail-safe.ts");function s(e,t,r){t.success&&n.isFunction(t.success)&&a.wrapWithTryCatch(t.success,"at api "+e+" success callback function;")(r)}function i(e,t,r){t.fail&&n.isFunction(t.fail)&&a.wrapWithTryCatch(t.fail,"at api "+e+" fail callback function;")(r)}function o(e,t,r){t.complete&&n.isFunction(t.complete)&&a.wrapWithTryCatch(t.complete,"at api "+e+" complete callback function;")(r)}t.invokeSuccessCallback=s,t.invokeFailCallback=i,t.invokeCompleteCallback=o,t.invokeSuccessCompleteCallbacks=function(e,t,r){s(e,t,r),o(e,t,r)},t.invokeFailCompleteCallbacks=function(e,t,r){i(e,t,r),o(e,t,r)},t.hasAPICallback=function(e){return e&&(e.success||e.fail||e.complete)}},"./src/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r("./src/cloud/index.ts"),r("./src/services/index.ts")},"./src/network/tunnel.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/cloud/index.ts"),s=r("./src/utils/error.ts"),i=r("./src/externals/public-lib/appserviceSdk.ts"),o=r("./src/config/error.config.ts");function c(e,t){return new Promise(function(r,a){i._operateWXData({apiName:e.apiName||"qbase_commapi",reqData:e.data,success:function(e){var i=n.__assign({},e,{data:e.rawData});if(e.rawData)try{var o=JSON.parse(e.rawData);if(o.baseresponse&&0!==o.baseresponse.errcode){var c=new s.CloudSDKError({errCode:o.baseresponse.errcode,errMsg:o.baseresponse.errmsg});return void a(c)}if(o.hasOwnProperty("status")&&0!==o.status){c=new s.CloudSDKError({errCode:o.status,errMsg:o.errmsg||""});return void a(c)}i=n.__assign({},e,{data:o})}catch(e){c=new s.CloudSDKError({errMsg:e&&e.toString()});return void a(c)}else if(t&&t.requireDataNotEmpty){c=new s.CloudSDKError({errCode:e.errCode,errMsg:"error empty internal server response, "+e.errMsg});return void a(c)}r(i)},fail:function(e){e&&e.errMsg&&/^undefined:fail /.test(e.errMsg)&&("operateWXData:fail invalid scope"===e.errMsg?e.errMsg="invalid scope 没有权限，请先开通云服务":e.errMsg=e.errMsg.replace(/^undefined:fail /,"")),a(e)},complete:e.complete})})}t.tunnel=c,t.constructTunnelReq=function(e,t,r){var n=a.default.getOverriddenConfig(r||{});if(!function(e){return!a.default.apiPermissions.hasOwnProperty(e)||1===a.default.apiPermissions[e]}(e))throw s.returnAsCloudSDKError({errCode:o.ERR_CODE.SDK_API_PERMISSION_DENIED,errMsg:o.ERR_CODE[o.ERR_CODE.SDK_API_PERMISSION_DENIED]});return{apiName:"qbase_commapi",data:{qbase_api_name:e,qbase_req:t,qbase_options:{env:a.default.getEnv(n,r&&r.serviceName||"")},qbase_meta:a.default.getMetaData(),cli_req_id:+new Date+"_"+Math.random()}}},t.default=c},"./src/services/database/api/api.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/services/database/api/database.ts");t.getAPIs=function(){return{database:n.default}}},"./src/services/database/api/database.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/services/database/api/database/command.ts"),a=r("./src/services/database/api/database/collection.ts"),s=r("./src/services/database/api/database/geo.ts"),i=r("./src/services/database/api/database/date.ts"),o=r("./src/services/database/internal/grammar/engine.ts"),c=r("./src/utils/assert.ts");function u(e){return e.debug}t.default=function(e){return new l(e)};var l=function(){function e(e){var t=this;this.config=e||{},e&&e.env&&c.assertType(e.env,"string"),this.command=n.commands,this.Geo=s,this.serverDate=i.serverDate,this.engine=o.getEngine(),Object.defineProperties(this,{engine:{enumerable:!1,configurable:!1}}),Object.defineProperties(this,{QuerySerializer:{enumerable:!1,configurable:!1,get:function(){return function(e){return u(e)?e.engine.QuerySerializer:void 0}(t)},set:function(){}},UpdateSerializer:{enumerable:!1,configurable:!1,get:function(){return function(e){return u(e)?e.engine.UpdateSerializer:void 0}(t)},set:function(){}},Decoder:{enumerable:!1,configurable:!1,get:function(){return function(e){return u(e)?e.engine.Decoder:void 0}(t)},set:function(){}}})}return e.prototype.collection=function(e){return new a.CollectionReference(e,this)},e}();t.Database=l},"./src/services/database/api/database/collection.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/services/database/api/database/query.ts"),s=r("./src/services/database/api/database/document.ts"),i=r("./src/hook/invoke.ts"),o=r("./src/services/database/internal/backend-api/backend-api.ts"),c=r("./src/utils/msg.ts"),u=r("./src/utils/error.ts"),l=r("./src/utils/assert.ts"),d=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.collectionName=t,n.database=r,n}return n.__extends(t,e),t.prototype.doc=function(e){return new s.DocumentReference(this,e,this.database)},t.prototype.add=function(e){var t=this,r="collection.add",a=i.hasAPICallback(e),s=new Promise(function(a,s){return n.__awaiter(t,void 0,void 0,function(){var t,i;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),l.assertType(e,{data:"object"}),[4,o.addDocument(this.collectionName,e.data._id,this.database.engine.encodeInternalDataType(e.data),this.database.config)];case 1:return t=n.sent(),a({_id:t._id,errMsg:c.apiSuccessMsg(r)}),[3,3];case 2:return i=n.sent(),s(u.returnAsFinalCloudSDKError(i,r)),[3,3];case 3:return[2]}})})});if(!a)return s;s.then(function(t){i.invokeSuccessCompleteCallbacks(r,e,t)}).catch(function(t){i.invokeFailCompleteCallbacks(r,e,t)})},t}(a.Query);t.CollectionReference=d},"./src/services/database/api/database/command.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/services/database/api/database/commands/query.ts"),a=r("./src/services/database/api/database/commands/logic.ts"),s=r("./src/services/database/api/database/commands/update.ts"),i=r("./src/utils/type.ts");t.commands={eq:function(e){return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.EQ,[e])},neq:function(e){return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.NEQ,[e])},lt:function(e){return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.LT,[e])},lte:function(e){return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.LTE,[e])},gt:function(e){return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.GT,[e])},gte:function(e){return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.GTE,[e])},in:function(e){return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.IN,e)},nin:function(e){return new n.QueryCommmand(n.QUERY_COMMANDS_LITERAL.NIN,e)},and:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=i.isArray(arguments[0])?arguments[0]:Array.from(arguments);return new a.LogicCommmand(a.LOGIC_COMMANDS_LITERAL.AND,r)},or:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=i.isArray(arguments[0])?arguments[0]:Array.from(arguments);return new a.LogicCommmand(a.LOGIC_COMMANDS_LITERAL.OR,r)},set:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.SET,[e])},remove:function(){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.REMOVE,[])},inc:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.INC,[e])},mul:function(e){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.MUL,[e])},push:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=i.isArray(arguments[0])?arguments[0]:Array.from(arguments);return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.PUSH,r)},pop:function(){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.POP,[])},shift:function(){return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.SHIFT,[])},unshift:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=i.isArray(arguments[0])?arguments[0]:Array.from(arguments);return new s.UpdateCommand(s.UPDATE_COMMANDS_LITERAL.UNSHIFT,r)}},t.default=t.commands},"./src/services/database/api/database/commands/logic.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,a=r("./src/services/database/api/database/helper/symbol.ts"),s=r("./src/utils/assert.ts"),i=r("./src/utils/type.ts"),o=r("./src/services/database/api/database/commands/query.ts");t.AND="and",t.OR="or",t.NOT="not",t.NOR="nor",function(e){e.AND="and",e.OR="or",e.NOT="not",e.NOR="nor"}(n=t.LOGIC_COMMANDS_LITERAL||(t.LOGIC_COMMANDS_LITERAL={}));var c=function(){function e(e,t,r){this._internalType=a.SYMBOL_LOGIC_COMMAND,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t;this.fieldName=r||a.SYMBOL_UNSET_FIELD_NAME;if(this.fieldName!==a.SYMBOL_UNSET_FIELD_NAME){t=t.slice(),this.operands=t;for(var n=0,s=t.length;n<s;n++){var i=t[n];(u(i)||o.isQueryCommand(i))&&(t[n]=i._setFieldName(this.fieldName))}}}return e.prototype._setFieldName=function(t){var r=this.operands.map(function(r){return r instanceof e?r._setFieldName(t):r});return new e(this.operator,r,t)},e.prototype.and=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];s.assertRequiredParam(arguments[0],"expressions","and");var a=i.isArray(arguments[0])?arguments[0]:Array.from(arguments);return a.unshift(this),new e(n.AND,a,this.fieldName)},e.prototype.or=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];s.assertRequiredParam(arguments[0],"expressions","or");var a=i.isArray(arguments[0])?arguments[0]:Array.from(arguments);return a.unshift(this),new e(n.OR,a,this.fieldName)},e}();function u(e){return e&&e instanceof c&&e._internalType===a.SYMBOL_LOGIC_COMMAND}t.LogicCommmand=c,t.isLogicCommand=u,t.isKnownLogicCommand=function(e){return u&&e.operator.toUpperCase()in n},t.default=c},"./src/services/database/api/database/commands/query.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,a=r("./node_modules/tslib/tslib.es6.js"),s=r("./src/services/database/api/database/commands/logic.ts"),i=r("./src/services/database/api/database/helper/symbol.ts"),o=r("./src/utils/assert.ts");t.EQ="eq",t.NEQ="neq",t.GT="gt",t.GTE="gte",t.LT="lt",t.LTE="lte",t.IN="in",t.NIN="nin",function(e){e.EQ="eq",e.NEQ="neq",e.GT="gt",e.GTE="gte",e.LT="lt",e.LTE="lte",e.IN="in",e.NIN="nin"}(n=t.QUERY_COMMANDS_LITERAL||(t.QUERY_COMMANDS_LITERAL={}));var c=function(e){function t(t,r,n){var a=e.call(this,t,r,n)||this;return a.operator=t,a._internalType=i.SYMBOL_QUERY_COMMAND,a}return a.__extends(t,e),t.prototype._setFieldName=function(e){return new t(this.operator,this.operands,e)},t.prototype.eq=function(e){var r=new t(n.EQ,[e],this.fieldName);return this.and(r)},t.prototype.neq=function(e){var r=new t(n.NEQ,[e],this.fieldName);return this.and(r)},t.prototype.gt=function(e){var r=new t(n.GT,[e],this.fieldName);return this.and(r)},t.prototype.gte=function(e){var r=new t(n.GTE,[e],this.fieldName);return this.and(r)},t.prototype.lt=function(e){var r=new t(n.LT,[e],this.fieldName);return this.and(r)},t.prototype.lte=function(e){var r=new t(n.LTE,[e],this.fieldName);return this.and(r)},t.prototype.in=function(e){o.assertType(e,"array");var r=new t(n.IN,e,this.fieldName);return this.and(r)},t.prototype.nin=function(e){o.assertType(e,"array");var r=new t(n.NIN,e,this.fieldName);return this.and(r)},t}(s.LogicCommmand);function u(e){return e&&e instanceof c&&e._internalType===i.SYMBOL_QUERY_COMMAND}t.QueryCommmand=c,t.isQueryCommand=u,t.isKnownQueryCommand=function(e){return u(e)&&e.operator.toUpperCase()in n},t.isComparisonCommand=function(e){return u(e)},t.default=c},"./src/services/database/api/database/commands/update.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,a=r("./src/services/database/api/database/helper/symbol.ts");t.SET="set",t.REMOVE="remove",t.INC="inc",t.MUL="mul",t.PUSH="push",t.POP="pop",t.SHIFT="shift",t.UNSHIFT="unshift",function(e){e.SET="set",e.REMOVE="remove",e.INC="inc",e.MUL="mul",e.PUSH="push",e.POP="pop",e.SHIFT="shift",e.UNSHIFT="unshift"}(n=t.UPDATE_COMMANDS_LITERAL||(t.UPDATE_COMMANDS_LITERAL={}));var s=function(){function e(e,t,r){this._internalType=a.SYMBOL_UPDATE_COMMAND,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=r||a.SYMBOL_UNSET_FIELD_NAME}return e.prototype._setFieldName=function(t){return new e(this.operator,this.operands,t)},e}();function i(e){return e&&e instanceof s&&e._internalType===a.SYMBOL_UPDATE_COMMAND}t.UpdateCommand=s,t.isUpdateCommand=i,t.isKnownUpdateCommand=function(e){return i(e)&&e.operator.toUpperCase()in n},t.default=s},"./src/services/database/api/database/date.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r("./node_modules/tslib/tslib.es6.js").__exportStar(r("./src/services/database/api/database/date/serverDate.ts"),t)},"./src/services/database/api/database/date/serverDate.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/services/database/api/database/helper/symbol.ts"),a=r("./src/utils/assert.ts");t.serverDate=function(e){return new s(e)};var s=function(){function e(e){void 0===e&&(e={offset:0}),a.assertType(e,"object","serverDate.options"),this.options=e}return Object.defineProperty(e.prototype,"_internalType",{get:function(){return n.SYMBOL_SERVER_DATE},enumerable:!0,configurable:!0}),e}();t.ServerDate=s},"./src/services/database/api/database/document.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/hook/invoke.ts"),s=r("./src/services/database/internal/backend-api/backend-api.ts"),i=r("./src/utils/msg.ts"),o=r("./src/utils/error.ts"),c=r("./src/services/database/internal/grammar/default/extractor.ts"),u=r("./src/utils/assert.ts"),l=function(){function e(e,t,r){this.collection=e,this.database=r,this._id=t,Object.defineProperties(this,{_field:{enumerable:!1,configurable:!1,writable:!0}}),this._field={}}return e.prototype.field=function(e){return u.assertRequiredParam(e,"object","field"),u.assertType(e,"object","field"),this._field=e,this},e.prototype.get=function(e){var t=this,r=a.hasAPICallback(e),u=new Promise(function(e,r){return n.__awaiter(t,void 0,void 0,function(){var t,a,u;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=this._id,[4,s.queryDocument(this.database,this.collection.collectionName,this.database.engine.QuerySerializer.encode({_id:t}),{projection:c.getProjectionDefinition(this._field)},this.database.config)];case 1:if(!(a=n.sent()).list||!a.list.length)throw new Error("cannot find document with _id "+t+", please make sure that the document exists and you have the corresponding access permission");return e({data:a.list[0],errMsg:i.apiSuccessMsg("document.get")}),[3,3];case 2:return u=n.sent(),r(o.returnAsFinalCloudSDKError(u,"document.get")),[3,3];case 3:return[2]}})})});if(!r)return u;u.then(function(t){a.invokeSuccessCompleteCallbacks("document.get",e,t)}).catch(function(t){a.invokeFailCompleteCallbacks("document.get",e,t)})},e.prototype.set=function(e){var t=this,r=a.hasAPICallback(e),c=new Promise(function(r,a){return n.__awaiter(t,void 0,void 0,function(){var t,c,l;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),u.assertType(e,{data:"object"}),u.assertObjectNotEmpty({name:"options.data",target:e.data}),t=this._id,[4,s.setDocument(this.collection.collectionName,t,e.data,{},this.database.config)];case 1:return c=n.sent(),r({_id:c._id,errMsg:i.apiSuccessMsg("document.set"),stats:{updated:c.updated,created:c.created}}),[3,3];case 2:return l=n.sent(),a(o.returnAsFinalCloudSDKError(l,"document.set")),[3,3];case 3:return[2]}})})});if(!r)return c;c.then(function(t){a.invokeSuccessCompleteCallbacks("document.set",e,t)}).catch(function(t){a.invokeFailCompleteCallbacks("document.set",e,t)})},e.prototype.update=function(e){var t=this,r=a.hasAPICallback(e),c=new Promise(function(r,a){return n.__awaiter(t,void 0,void 0,function(){var t,c,l;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),u.assertType(e,{data:"object"}),u.assertObjectNotEmpty({name:"options.data",target:e.data}),t=this._id,[4,s.updateDocument(this.collection.collectionName,this.database.engine.QuerySerializer.encode({_id:t}),this.database.engine.UpdateSerializer.encode(e.data),{multi:!1,merge:!1},this.database.config)];case 1:return c=n.sent(),r({stats:{updated:c.updated},errMsg:i.apiSuccessMsg("document.update")}),[3,3];case 2:return l=n.sent(),a(o.returnAsFinalCloudSDKError(l,"document.update")),[3,3];case 3:return[2]}})})});if(!r)return c;c.then(function(t){a.invokeSuccessCompleteCallbacks("document.update",e,t)}).catch(function(t){a.invokeFailCompleteCallbacks("document.update",e,t)})},e.prototype.remove=function(e){var t=this,r=a.hasAPICallback(e),c=new Promise(function(e,r){return n.__awaiter(t,void 0,void 0,function(){var t,a,c;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=this._id,[4,s.removeDocument(this.collection.collectionName,this.database.engine.QuerySerializer.encode({_id:t}),{},this.database.config)];case 1:if(0===(a=n.sent()).removed)throw new Error("cannot remove document with _id "+t+", please make sure that the document exists and you have the corresponding Write permission");return e({stats:{removed:a.removed||0},errMsg:i.apiSuccessMsg("document.remove")}),[3,3];case 2:return c=n.sent(),r(o.returnAsFinalCloudSDKError(c,"document.remove")),[3,3];case 3:return[2]}})})});if(!r)return c;c.then(function(t){a.invokeSuccessCompleteCallbacks("document.remove",e,t)}).catch(function(t){a.invokeFailCompleteCallbacks("document.remove",e,t)})},e}();t.DocumentReference=l},"./src/services/database/api/database/geo.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r("./node_modules/tslib/tslib.es6.js").__exportStar(r("./src/services/database/api/database/geo/point.ts"),t)},"./src/services/database/api/database/geo/point.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/services/database/api/database/helper/symbol.ts"),a=r("./src/utils/assert.ts"),s=r("./src/utils/error.ts");t.Point=function(e,t){return new i(e,t)};var i=function(){function e(e,t){this._internalType=n.SYMBOL_GEO_POINT,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}});var r=e,i=t;Object.defineProperties(this,{longitude:{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){if(a.assertType(e,"number","longitude"),e>180||e<-180)throw new s.CloudSDKError({errMsg:"longitude should be a number ranges from -180 to 180"})}},latitude:{enumerable:!0,configurable:!1,get:function(){return i},set:function(e){if(a.assertType(e,"number","latitude"),e>90||e<-90)throw new s.CloudSDKError({errMsg:"latitude should be a number ranges from -90 to 90"})}}}),this.longitude=r,this.latitude=i}return e.prototype.toJSON=function(){return{type:"Point",coordinates:[this.longitude,this.latitude]}},e.prototype.toString=function(){return JSON.stringify(this.toJSON())},e}();t.GeoPoint=i},"./src/services/database/api/database/helper/symbol.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/utils/symbol.ts");n.__exportStar(r("./src/utils/symbol.ts"),t),t.SYMBOL_UNSET_FIELD_NAME=a.default.for("UNSET_FIELD_NAME"),t.SYMBOL_UPDATE_COMMAND=a.default.for("UPDATE_COMMAND"),t.SYMBOL_QUERY_COMMAND=a.default.for("QUERY_COMMAND"),t.SYMBOL_LOGIC_COMMAND=a.default.for("LOGIC_COMMAND"),t.SYMBOL_GEO_POINT=a.default.for("GEO_POINT"),t.SYMBOL_SERVER_DATE=a.default.for("SERVER_DATE")},"./src/services/database/api/database/query.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/utils/msg.ts"),s=r("./src/services/database/internal/grammar/default/extractor.ts"),i=r("./src/utils/assert.ts"),o=r("./src/services/database/internal/backend-api/backend-api.ts"),c=r("./src/hook/invoke.ts"),u=r("./src/utils/error.ts"),l=r("./src/services/database/api/database/command.ts");!function(e){e.ASC="asc",e.DESC="desc"}(t.ORDER_DIRECTION||(t.ORDER_DIRECTION={}));var d=function(){function e(e,t,r){this.collectionName=e,this.database=t,this._query=new f(r),Object.defineProperties(this,{_field:{enumerable:!1,configurable:!1,writable:!0}}),this._field=r&&r.field||{}}return e.prototype.field=function(t){return i.assertRequiredParam(t,"object","field"),new e(this.collectionName,this.database,n.__assign({},this._query.getProperties(),{field:t}))},e.prototype.where=function(t){return i.assertRequiredParam(t,"condition","where"),this._query.where?new e(this.collectionName,this.database,n.__assign({},this._query.getProperties(),{where:l.commands.and(this._query.where,t)})):new e(this.collectionName,this.database,n.__assign({},this._query.getProperties(),{where:t}))},e.prototype.orderBy=function(t,r){return i.assertRequiredParam(t,"fieldPath","orderBy"),i.assertRequiredParam(r,"order","orderBy"),new e(this.collectionName,this.database,n.__assign({},this._query.getProperties(),{order:n.__spread(this._query.order||[],[{fieldPath:t,order:r}])}))},e.prototype.limit=function(t){return i.assertRequiredParam(t,"max","limit"),new e(this.collectionName,this.database,n.__assign({},this._query.getProperties(),{limit:t}))},e.prototype.skip=function(t){return i.assertRequiredParam(t,"offset","skip"),new e(this.collectionName,this.database,n.__assign({},this._query.getProperties(),{offset:t}))},e.prototype.get=function(e){var t=this,r="collection.get",i=c.hasAPICallback(e),l=new Promise(function(e,i){return n.__awaiter(t,void 0,void 0,function(){var t,c;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,o.queryDocument(this.database,this.collectionName,this.database.engine.QuerySerializer.encode(this._query.where||{}),s.extractQueryOptions(this),this.database.config)];case 1:return t=n.sent(),e({data:t.list,errMsg:a.apiSuccessMsg(r)}),[3,3];case 2:return c=n.sent(),i(u.returnAsFinalCloudSDKError(c,r)),[3,3];case 3:return[2]}})})});if(!i)return l;l.then(function(t){c.invokeSuccessCompleteCallbacks(r,e,t)}).catch(function(t){c.invokeFailCompleteCallbacks(r,e,t)})},e.prototype.count=function(e){var t=this,r="collection.count",s=c.hasAPICallback(e),i=new Promise(function(e,s){return n.__awaiter(t,void 0,void 0,function(){var t,i;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,o.countDocument(this.collectionName,this.database.engine.QuerySerializer.encode(this._query.where||{}),this.database.config)];case 1:return t=n.sent(),e({total:t.total,errMsg:a.apiSuccessMsg(r)}),[3,3];case 2:return i=n.sent(),s(u.returnAsFinalCloudSDKError(i,r)),[3,3];case 3:return[2]}})})});if(!s)return i;i.then(function(t){c.invokeSuccessCompleteCallbacks(r,e,t)}).catch(function(t){c.invokeFailCompleteCallbacks(r,e,t)})},e}();t.Query=d;var f=function(){function e(e){this.where=e&&e.where,this.offset=e&&e.offset,this.limit=e&&e.limit,this.order=e&&e.order}return e.prototype.getProperties=function(){return{where:this.where,offset:this.offset,limit:this.limit,order:this.order}},e}();t.InternalQuery=f},"./src/services/database/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/cloud/index.ts"),a=r("./src/services/database/api/api.ts"),s="database";function i(e){e.registerService({name:s,getAPIs:a.getAPIs})}t.registerService=i,i(n.default)},"./src/services/database/internal/backend-api/backend-api.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/network/tunnel.ts"),s=r("./src/utils/assert.ts"),i=r("./src/cloud/index.ts");!function(e){e[e.ASC=0]="ASC",e[e.DESC=1]="DESC"}(t.ORDER_DIRECTION||(t.ORDER_DIRECTION={})),t.addDocument=function(e,t,r,o){return n.__awaiter(this,void 0,void 0,function(){var c,u,l;return n.__generator(this,function(d){switch(d.label){case 0:return c=JSON.stringify(r),s.assertStringLength({input:c,max:i.default.appConfig.db_doc_size_limit,name:"record",maxWording:(i.default.appConfig.db_doc_size_limit/1024).toFixed(0)+" KB"}),u={collection_name:e,_id:t,data:c},l=JSON.stringify(u),[4,a.tunnel(a.constructTunnelReq("tcbapi_db_adddocument",l,n.__assign({},o,{serviceName:"database"})),{requireDataNotEmpty:!0})];case 1:return[2,{_id:d.sent().data._id}]}})})},t.removeDocument=function(e,t,r,s){var i=(void 0===r?{}:r).multi,o=void 0===i||i;return n.__awaiter(this,void 0,void 0,function(){var r;return n.__generator(this,function(i){switch(i.label){case 0:return r=JSON.stringify({collection_name:e,query:JSON.stringify(t),multi:o}),[4,a.tunnel(a.constructTunnelReq("tcbapi_db_deletedocument",r,n.__assign({},s,{serviceName:"database"})),{requireDataNotEmpty:!0})];case 1:return[2,{removed:i.sent().data.deleted}]}})})},t.queryDocument=function(e,t,r,s,i){return void 0===s&&(s={}),n.__awaiter(this,void 0,void 0,function(){var o,c,u,l,d;return n.__generator(this,function(f){switch(f.label){case 0:return o={collection_name:t,query:JSON.stringify(r)},s.offset&&(o.offset=s.offset),s.limit&&(o.limit=s.limit),s.order&&(o.order=s.order),s.projection&&(o.projection=JSON.stringify(s.projection)),c=JSON.stringify(o),[4,a.tunnel(a.constructTunnelReq("tcbapi_db_querydocument",c,n.__assign({},i,{serviceName:"database"})),{requireDataNotEmpty:!0})];case 1:return u=f.sent(),l=u.data,d=l.data_list?JSON.parse(l.data_list):[],[2,{list:d=e.engine.Decoder.decode(d),offset:l.offset,limit:l.limit,total:l.total}]}})})},t.updateDocument=function(e,t,r,o,c){return void 0===o&&(o={}),n.__awaiter(this,void 0,void 0,function(){var u,l,d;return n.__generator(this,function(f){switch(f.label){case 0:return u=JSON.stringify(r),s.assertStringLength({input:u,max:i.default.appConfig.db_doc_size_limit,name:"update expression",maxWording:(i.default.appConfig.db_doc_size_limit/1024).toFixed(0)+" KB"}),(l={collection_name:e,query:JSON.stringify(t),data:u}).multi=!1!==o.multi,l.merge=!1!==o.merge,o.upsert&&(l.upsert=o.upsert),d=JSON.stringify(l),[4,a.tunnel(a.constructTunnelReq("tcbapi_db_updatedocument",d,n.__assign({},c,{serviceName:"database"})),{requireDataNotEmpty:!0})];case 1:return[2,{updated:f.sent().data.updated}]}})})},t.setDocument=function(e,t,r,o,c){return void 0===o&&(o={}),n.__awaiter(this,void 0,void 0,function(){var o,u,l,d,f;return n.__generator(this,function(_){switch(_.label){case 0:return o=JSON.stringify(r),s.assertStringLength({input:o,max:i.default.appConfig.db_doc_size_limit,name:"record",maxWording:(i.default.appConfig.db_doc_size_limit/1024).toFixed(0)+" KB"}),u={collection_name:e,_id:t,data:o},l=JSON.stringify(u),[4,a.tunnel(a.constructTunnelReq("tcbapi_db_setdocument",l,n.__assign({},c,{serviceName:"database"})),{requireDataNotEmpty:!0})];case 1:return d=_.sent(),[2,{_id:(f=d.data)._id||t,updated:f._id?0:1,created:f._id?1:0}]}})})},t.countDocument=function(e,t,r){return n.__awaiter(this,void 0,void 0,function(){var s,i;return n.__generator(this,function(o){switch(o.label){case 0:return s={collection_name:e,query:JSON.stringify(t)},i=JSON.stringify(s),[4,a.tunnel(a.constructTunnelReq("tcbapi_db_countdocument",i,n.__assign({},r,{serviceName:"database"})),{requireDataNotEmpty:!0})];case 1:return[2,{total:o.sent().data.total}]}})})}},"./src/services/database/internal/grammar/default/extractor.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/services/database/api/database/query.ts"),a=r("./src/services/database/internal/backend-api/backend-api.ts"),s=r("./src/services/database/internal/grammar/default/serializer/common.ts");function i(e){var t=s.flattenObject(e);for(var r in t)!0===t[r]||1===t[r]?t[r]=1:!1===t[r]||0===t[r]?t[r]=0:delete t[r];return t}t.extractQueryOptions=function(e){return{limit:e._query.limit,offset:e._query.offset,order:(e._query.order||[]).map(function(e){return{field:e.fieldPath,direction:e.order===n.ORDER_DIRECTION.DESC?a.ORDER_DIRECTION.DESC:a.ORDER_DIRECTION.ASC}}),projection:i(e._field)}},t.getProjectionDefinition=i},"./src/services/database/internal/grammar/default/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js");n.__exportStar(r("./src/services/database/internal/grammar/default/extractor.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/operator-map.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/serializer.ts"),t)},"./src/services/database/internal/grammar/default/operator-map.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/services/database/api/database/commands/query.ts"),a=r("./src/services/database/api/database/commands/logic.ts"),s=r("./src/services/database/api/database/commands/update.ts");for(var i in t.OperatorMap={},n.QUERY_COMMANDS_LITERAL)t.OperatorMap[i]="$"+i.toLowerCase();for(var i in a.LOGIC_COMMANDS_LITERAL)t.OperatorMap[i]="$"+i.toLowerCase();for(var i in s.UPDATE_COMMANDS_LITERAL)t.OperatorMap[i]="$"+i.toLowerCase();t.OperatorMap[n.QUERY_COMMANDS_LITERAL.NEQ]="$ne",t.OperatorMap[s.UPDATE_COMMANDS_LITERAL.REMOVE]="$unset",t.OperatorMap[s.UPDATE_COMMANDS_LITERAL.SHIFT]="$pop",t.OperatorMap[s.UPDATE_COMMANDS_LITERAL.UNSHIFT]="$push",t.operatorToString=function(e){return t.OperatorMap[e]||"$"+e.toLowerCase()}},"./src/services/database/internal/grammar/default/serializer.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js");n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/query.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/update.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/decoder.ts"),t),n.__exportStar(r("./src/services/database/internal/grammar/default/serializer/common.ts"),t)},"./src/services/database/internal/grammar/default/serializer/common.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/utils/error.ts"),s=r("./src/config/error.config.ts"),i=r("./src/utils/type.ts"),o=r("./src/services/database/internal/grammar/default/serializer/datatype.ts");function c(e,t,r,o){var u=n.__assign({},e);for(var l in e)if(!/^\$/.test(l)){var d=e[l];if(d&&i.isObject(d)&&!t(d)){if(o.indexOf(d)>-1)throw new a.CloudSDKError({errCode:s.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});var f=c(d,t,n.__spread(r,[l]),n.__spread(o,[d]));u[l]=f;var _=!1;for(var p in f)/^\$/.test(p)?_=!0:(u[l+"."+p]=f[p],delete u[l][p]);_||delete u[l]}}return u}function u(e){return i.isInternalObject(e)||i.isDate(e)}t.flattenQueryObject=function(e){return c(e,u,[],[e])},t.flattenObject=function(e){return c(e,function(e){return!1},[],[e])},t.mergeConditionAfterEncode=function(e,t,r){for(var n in t[r]||delete e[r],t)e[n]?i.isArray(e[n])?e[n].push(t[n]):i.isObject(e[n])?i.isObject(t[n])?Object.assign(e[n],t[n]):(console.warn("unmergable condition, query is object but condition is "+i.getType(t)+", can only overwrite",t,r),e[n]=t[n]):(console.warn("to-merge query is of type "+i.getType(e)+", can only overwrite",e,t,r),e[n]=t[n]):e[n]=t[n]},t.isConversionRequired=u,t.encodeInternalDataType=function(e){return o.serialize(e)},t.decodeInternalDataType=function(e){return o.deserialize(e)}},"./src/services/database/internal/grammar/default/serializer/datatype.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/services/database/api/database/helper/symbol.ts"),s=r("./src/utils/type.ts"),i=r("./src/services/database/api/database/geo.ts"),o=r("./src/services/database/api/database/date.ts"),c=r("./src/utils/error.ts"),u=r("./src/config/error.config.ts");t.serialize=function(e){return function e(t,r){if(!s.isInternalObject(t)){if(s.isDate(t))return{$date:+t};if(s.isArray(t))return t.map(function(t){if(r.indexOf(t)>-1)throw new c.CloudSDKError({errCode:u.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});return e(t,n.__spread(r,[t]))});if(s.isObject(t)){var i=n.__assign({},t);for(var o in i){if(r.indexOf(i[o])>-1)throw new c.CloudSDKError({errCode:u.ERR_CODE.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});i[o]=e(i[o],n.__spread(r,[i[o]]))}return i}return t}switch(t._internalType){case a.SYMBOL_GEO_POINT:return t.toJSON();case a.SYMBOL_SERVER_DATE:return{$date:t.options};default:return t.toJSON?t.toJSON():t}}(e,[e])},t.deserialize=function(e){var t=n.__assign({},e);for(var r in t)switch(r){case"$date":switch(s.getType(t[r])){case"number":return new Date(t[r]);case"object":return o.serverDate(t[r])}break;case"type":switch(t.type){case"Point":if(s.isArray(t.coordinates)&&s.isNumber(t.coordinates[0])&&s.isNumber(t.coordinates[1]))return new i.Point(t.coordinates[0],t.coordinates[1])}}return e}},"./src/services/database/internal/grammar/default/serializer/decoder.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/utils/type.ts"),s=r("./src/services/database/internal/grammar/default/serializer/common.ts"),i=function(){function e(){}return e.decode=function(t){return(new e).decodeData(t)},e.prototype.decodeData=function(e){var t=this;switch(a.getType(e)){case"object":return this.decodeObject(e);case"array":return e.map(function(e){if(a.isObject(e)){var r=s.decodeInternalDataType(e);return r!==e?r:t.decodeObject(e)}return e});default:return e}},e.prototype.decodeObject=function(e){var t=n.__assign({},e);for(var r in t){var i=t[r];switch(a.getType(i)){case"object":var o=s.decodeInternalDataType(i);t[r]=o!==i?o:this.decodeObject(t[r]);break;case"array":(o=this.decodeData(i))!==i&&(t[r]=o);break;default:continue}}return t},e}();t.Decoder=i},"./src/services/database/internal/grammar/default/serializer/query.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/services/database/api/database/commands/query.ts"),a=r("./src/services/database/api/database/commands/logic.ts"),s=r("./src/services/database/api/database/helper/symbol.ts"),i=r("./src/utils/type.ts"),o=r("./src/utils/error.ts"),c=r("./src/services/database/internal/grammar/default/operator-map.ts"),u=r("./src/services/database/internal/grammar/default/serializer/common.ts"),l=function(){function e(){}return e.encode=function(e){return(new d).encodeQuery(e)},e}();t.QuerySerializer=l;var d=function(){function e(){}return e.prototype.encodeQuery=function(e){return u.isConversionRequired(e)?a.isLogicCommand(e)?this.encodeLogicCommand(e):n.isQueryCommand(e)?this.encodeQueryCommand(e):this.encodeQueryObject(e):i.isObject(e)?this.encodeQueryObject(e):e},e.prototype.encodeLogicCommand=function(e){var t,r,n;switch(e.operator){case a.LOGIC_COMMANDS_LITERAL.AND:case a.LOGIC_COMMANDS_LITERAL.OR:var s=c.operatorToString(e.operator),i=e.operands.map(this.encodeQuery.bind(this));return(t={})[s]=i,t;default:s=c.operatorToString(e.operator);if(1===e.operands.length){var o=this.encodeQuery(e.operands[0]);return(r={})[s]=o,r}i=e.operands.map(this.encodeQuery.bind(this));return(n={})[s]=i,n}},e.prototype.encodeQueryCommand=function(e){return n.isComparisonCommand(e),this.encodeComparisonCommand(e)},e.prototype.encodeComparisonCommand=function(e){var t,r,a,i,l,d;if(e.fieldName===s.SYMBOL_UNSET_FIELD_NAME)throw new o.CloudSDKError({errMsg:"Cannot encode a comparison command with unset field name"});var f=c.operatorToString(e.operator);switch(e.operator){case n.QUERY_COMMANDS_LITERAL.EQ:case n.QUERY_COMMANDS_LITERAL.NEQ:case n.QUERY_COMMANDS_LITERAL.LT:case n.QUERY_COMMANDS_LITERAL.LTE:case n.QUERY_COMMANDS_LITERAL.GT:case n.QUERY_COMMANDS_LITERAL.GTE:return(t={})[e.fieldName]=((r={})[f]=u.encodeInternalDataType(e.operands[0]),r),t;case n.QUERY_COMMANDS_LITERAL.IN:case n.QUERY_COMMANDS_LITERAL.NIN:return(a={})[e.fieldName]=((i={})[f]=u.encodeInternalDataType(e.operands),i),a;default:return(l={})[e.fieldName]=((d={})[f]=u.encodeInternalDataType(e.operands[0]),d),l}},e.prototype.encodeQueryObject=function(e){var t=u.flattenQueryObject(e);for(var r in t){var s=t[r];if(a.isLogicCommand(s)){t[r]=s._setFieldName(r);var i=this.encodeLogicCommand(t[r]);this.mergeConditionAfterEncode(t,i,r)}else if(n.isComparisonCommand(s)){t[r]=s._setFieldName(r);i=this.encodeComparisonCommand(t[r]);this.mergeConditionAfterEncode(t,i,r)}else u.isConversionRequired(s)&&(t[r]=u.encodeInternalDataType(s))}return t},e.prototype.mergeConditionAfterEncode=function(e,t,r){for(var n in t[r]||delete e[r],t)e[n]?i.isArray(e[n])?e[n].push(t[n]):i.isObject(e[n])?i.isObject(t[n])?Object.assign(e,t):(console.warn("unmergable condition, query is object but condition is "+i.getType(t)+", can only overwrite",t,r),e[n]=t[n]):(console.warn("to-merge query is of type "+i.getType(e)+", can only overwrite",e,t,r),e[n]=t[n]):e[n]=t[n]},e}()},"./src/services/database/internal/grammar/default/serializer/update.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/services/database/api/database/commands/update.ts"),a=r("./src/services/database/api/database/helper/symbol.ts"),s=r("./src/utils/type.ts"),i=r("./src/utils/error.ts"),o=r("./src/services/database/internal/grammar/default/operator-map.ts"),c=r("./src/services/database/internal/grammar/default/serializer/common.ts"),u=function(){function e(){}return e.encode=function(t){return(new e).encodeUpdate(t)},e.prototype.encodeUpdate=function(e){return n.isUpdateCommand(e)?this.encodeUpdateCommand(e):"object"===s.getType(e)?this.encodeUpdateObject(e):e},e.prototype.encodeUpdateCommand=function(e){if(e.fieldName===a.SYMBOL_UNSET_FIELD_NAME)throw new i.CloudSDKError({errMsg:"Cannot encode a comparison command with unset field name"});switch(e.operator){case n.UPDATE_COMMANDS_LITERAL.SET:case n.UPDATE_COMMANDS_LITERAL.REMOVE:case n.UPDATE_COMMANDS_LITERAL.INC:case n.UPDATE_COMMANDS_LITERAL.MUL:return this.encodeFieldUpdateCommand(e);case n.UPDATE_COMMANDS_LITERAL.PUSH:case n.UPDATE_COMMANDS_LITERAL.POP:case n.UPDATE_COMMANDS_LITERAL.SHIFT:case n.UPDATE_COMMANDS_LITERAL.UNSHIFT:return this.encodeArrayUpdateCommand(e);default:return this.encodeFieldUpdateCommand(e)}},e.prototype.encodeFieldUpdateCommand=function(e){var t,r,a,s,i=o.operatorToString(e.operator);switch(e.operator){case n.UPDATE_COMMANDS_LITERAL.REMOVE:return(t={})[i]=((r={})[e.fieldName]="",r),t;case n.UPDATE_COMMANDS_LITERAL.SET:case n.UPDATE_COMMANDS_LITERAL.INC:case n.UPDATE_COMMANDS_LITERAL.MUL:default:return(a={})[i]=((s={})[e.fieldName]=e.operands[0],s),a}},e.prototype.encodeArrayUpdateCommand=function(e){var t,r,a,s,i,u,l,d,f,_,p=o.operatorToString(e.operator);switch(e.operator){case n.UPDATE_COMMANDS_LITERAL.PUSH:var m={$each:e.operands.map(c.encodeInternalDataType)};return(t={})[p]=((r={})[e.fieldName]=m,r),t;case n.UPDATE_COMMANDS_LITERAL.UNSHIFT:m={$each:e.operands.map(c.encodeInternalDataType),$position:0};return(a={})[p]=((s={})[e.fieldName]=m,s),a;case n.UPDATE_COMMANDS_LITERAL.POP:return(i={})[p]=((u={})[e.fieldName]=1,u),i;case n.UPDATE_COMMANDS_LITERAL.SHIFT:return(l={})[p]=((d={})[e.fieldName]=-1,d),l;default:return(f={})[p]=((_={})[e.fieldName]=c.encodeInternalDataType(e.operands),_),f}},e.prototype.encodeUpdateObject=function(e){var t=c.flattenQueryObject(e);for(var r in t)if(!/^\$/.test(r)){var a=t[r];if(n.isUpdateCommand(a)){t[r]=a._setFieldName(r);var s=this.encodeUpdateCommand(t[r]);c.mergeConditionAfterEncode(t,s,r)}else{t[r]=a=c.encodeInternalDataType(a);var i=new n.UpdateCommand(n.UPDATE_COMMANDS_LITERAL.SET,[a],r);s=this.encodeUpdateCommand(i);c.mergeConditionAfterEncode(t,s,r)}}return t},e}();t.UpdateSerializer=u},"./src/services/database/internal/grammar/engine.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n,a=r("./src/services/database/internal/grammar/default/index.ts");!function(e){e[e.DEFAULT=0]="DEFAULT"}(n=t.ENGINES||(t.ENGINES={})),t.getEngine=function(e){return void 0===e&&(e=n.DEFAULT),a}},"./src/services/functions/api/api.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/services/functions/api/callFunction.ts");t.getAPIs=function(){return{callFunction:n.default}}},"./src/services/functions/api/callFunction.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/network/tunnel.ts"),s=r("./src/utils/assert.ts"),i=r("./src/utils/error.ts"),o=r("./src/utils/fail-safe.ts"),c=r("./src/utils/serializer.ts"),u=r("./src/hook/invoke.ts"),l=r("./src/utils/msg.ts"),d=r("./src/utils/fn/clone.ts"),f=r("./src/config/error.config.ts"),_=r("./src/services/functions/index.ts"),p=r("./src/cloud/index.ts"),m=r("./src/externals/public-lib/appserviceSdk.ts");function E(e){return n.__awaiter(this,void 0,void 0,function(){var r;return n.__generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),function(e){s.assertType(e,{name:"string"}),e.data&&s.assertType(e.data,"object"),e.config&&e.config.env&&s.assertType(e.config.env,"string")}(e),[4,function(e){return n.__awaiter(this,void 0,void 0,function(){function r(e){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(r){return[2,new Promise(function(r,a){!function e(r,a,s,o){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return m._requestSkipCheckDomain({url:r,success:function(n){try{if(200!==n.statusCode)return o(i.returnAsFinalCloudSDKError({errCode:f.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_STATUS_CODE_ERROR,errMsg:"polling status code "+n.statusCode},t.API_NAME));var u=n.data;if(!u)return o(i.returnAsFinalCloudSDKError({errCode:f.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON,errMsg:f.ERR_CODE[f.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON]},t.API_NAME));if(u.base_resp&&0===u.base_resp.ret){if(0!==u.status){if(1===u.status){if(0!==u.service_errcode){var l=i.returnAsFinalCloudSDKError({errCode:f.ERR_CODE.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR,errMsg:"requestID "+u.func_req_id+", cloud function service error code "+(u.service_errcode||"unknown")+", error message "+(u.service_errmsg||"unknown")},t.API_NAME);return l.requestID=u.func_req_id,o(l)}var d=u.content;try{d=c.deserialize(d)}catch(e){try{d=JSON.parse(d)}catch(e){}}return s({result:d,requestID:u.func_req_id})}return o(i.returnAsFinalCloudSDKError({errCode:f.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_EXPIRED,errMsg:"timeout for result fetching"},t.API_NAME))}if(!(a>=0))return o(i.returnAsFinalCloudSDKError({errCode:f.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY,errMsg:f.ERR_CODE[f.ERR_CODE.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY]},t.API_NAME));e(r,a-1,s,o)}else{if(!u.base_resp)return o(i.returnAsFinalCloudSDKError({errCode:f.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP,errMsg:f.ERR_CODE[f.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP]},t.API_NAME));if(0!==u.base_resp.ret)return o(i.returnAsFinalCloudSDKError({errCode:f.ERR_CODE.SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL,errMsg:"polling base_resp.ret "+u.base_resp.ret},t.API_NAME))}}catch(e){o(i.returnAsFinalCloudSDKError({errCode:f.ERR_CODE.SDK_FUNCTIONS_POLL_ERROR,errMsg:"polling catch error: "+e},t.API_NAME))}},fail:function(e){o(i.returnAsFinalCloudSDKError(e,t.API_NAME))}}),[2]})})}(e,p.default.appConfig.call_function_poll_max_retry||50,r,a)})]})})}var o,u,d,E,b,v,g,h;return n.__generator(this,function(m){switch(m.label){case 0:return o=c.serialize(e.data),s.assertStringLength({input:o,max:p.default.appConfig.call_function_max_req_data_size,name:"callFunction data",maxWording:p.default.appConfig.call_function_max_req_data_size/1024+" KB"}),u={function_name:e.name,data:o},d=c.serialize(u),[4,a.tunnel(a.constructTunnelReq("tcbapi_slowcallfunction",d,n.__assign({},e.config,{serviceName:_.FUNCTIONS_SERVICE_NAME})))];case 1:if(E=m.sent(),!(b=E.data))throw i.returnAsFinalCloudSDKError({errCode:f.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT,errMsg:f.ERR_CODE[f.ERR_CODE.SDK_FUNCTIONS_EMPTY_CALL_RESULT]},t.API_NAME);if(b.event_id,!b.poll_url)throw i.returnAsFinalCloudSDKError({errCode:f.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_URL,errMsg:f.ERR_CODE[f.ERR_CODE.SDK_FUNCTIONS_EMPTY_POLL_URL]},t.API_NAME);return b.poll_url.indexOf("?")>-1?b.poll_url+="&devtools_ignore=true&skip_domain_check=true":b.poll_url+="?devtools_ignore=true&skip_domain_check=true",[4,r(b.poll_url)];case 2:return v=m.sent(),g=v.result,h=v.requestID,[2,{errMsg:l.apiSuccessMsg(t.API_NAME),result:g,requestID:h}]}})})}(e)];case 1:return[2,o.sent()];case 2:return[4,function(e){return n.__awaiter(this,void 0,void 0,function(){var r,s,i,o,u;return n.__generator(this,function(d){switch(d.label){case 0:return r={function_name:e.name,data:c.serialize(e.data)},s=c.serialize(r),[4,a.tunnel(a.constructTunnelReq("tcbapi_callfunction",s,n.__assign({},e.config,{serviceName:_.FUNCTIONS_SERVICE_NAME})))];case 1:if(i=d.sent(),o=i.data,u=o&&o.data)try{u=JSON.parse(u)}catch(e){}return[2,{errMsg:l.apiSuccessMsg(t.API_NAME),result:u}]}})})}(e)];case 3:return[2,o.sent()];case 4:return[3,6];case 5:throw r=o.sent(),i.returnAsFinalCloudSDKError(r,t.API_NAME);case 6:return[2]}})})}t.API_NAME="cloud.callFunction",t.default=function(e){return s.assertType(e,"object"),(e=d.shallowClone(e)).data||(e.data={}),u.hasAPICallback(e)?function(e){o.wrapParamCallbacksWithTryCatch({apiName:t.API_NAME,param:e}),E(e).then(function(r){u.invokeSuccessCompleteCallbacks(t.API_NAME,e,r)}).catch(function(r){u.invokeFailCompleteCallbacks(t.API_NAME,e,r)})}(e):E(e)}},"./src/services/functions/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/cloud/index.ts"),a=r("./src/services/functions/api/api.ts");function s(e){e.registerService({name:t.FUNCTIONS_SERVICE_NAME,getAPIs:a.getAPIs})}t.FUNCTIONS_SERVICE_NAME="functions",t.registerService=s,s(n.default)},"./src/services/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),r("./src/services/functions/index.ts"),r("./src/services/storage/index.ts"),r("./src/services/database/index.ts")},"./src/services/storage/api/api.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/services/storage/api/uploadFile.ts"),a=r("./src/services/storage/api/downloadFile.ts"),s=r("./src/services/storage/api/getTempFileURL.ts"),i=r("./src/services/storage/api/deleteFile.ts");t.getAPIs=function(){return{uploadFile:n.default,downloadFile:a.default,getTempFileURL:s.default,deleteFile:i.default}}},"./src/services/storage/api/deleteFile.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/network/tunnel.ts"),s=r("./src/utils/assert.ts"),i=r("./src/utils/error.ts"),o=r("./src/utils/serializer.ts"),c=r("./src/hook/invoke.ts"),u=r("./src/utils/msg.ts"),l=r("./src/utils/fn/clone.ts"),d=r("./src/config/error.config.ts"),f=r("./src/services/storage/index.ts"),_=r("./src/cloud/index.ts"),p="cloud.deleteFile";function m(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),function(e){for(var t in s.assertType(e,{fileList:"array"}),e.config&&e.config.env&&s.assertType(e.config.env,"string"),e.fileList)s.assertType(e.fileList[t],"string","parameter.fileList["+t+"]");if(_.default.appConfig.get_temp_file_url_max_requests&&e.fileList.length>_.default.appConfig.get_temp_file_url_max_requests)throw new i.CloudSDKError({errCode:d.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:"parameter.fileList exceed max length "+_.default.appConfig.get_temp_file_url_max_requests})}(e),e.fileList.length?[4,function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,s,i;return n.__generator(this,function(c){switch(c.label){case 0:return t={fileid_list:e.fileList},r=o.serialize(t),[4,a.tunnel(a.constructTunnelReq("tcbapi_deletefile",r,n.__assign({},e.config,{serviceName:f.STORAGE_SERVICE_NAME})))];case 1:return s=c.sent(),i=s.data,[2,{errMsg:u.apiSuccessMsg(p),fileList:i.delete_list.map(function(e){return{fileID:e.fileid,status:e.status,errMsg:e.errmsg}})}]}})})}(e)]:[2,{errMsg:u.apiSuccessMsg(p),fileList:[]}];case 1:return[2,r.sent()];case 2:throw t=r.sent(),i.returnAsFinalCloudSDKError(t,p);case 3:return[2]}})})}t.default=function(e){return e=l.shallowClone(e),c.hasAPICallback(e)?function(e){m(e).then(function(t){c.invokeSuccessCompleteCallbacks(p,e,t)}).catch(function(t){c.invokeFailCompleteCallbacks(p,e,t)})}(e):m(e)}},"./src/services/storage/api/downloadFile.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/network/tunnel.ts"),s=r("./src/utils/assert.ts"),i=r("./src/utils/type.ts"),o=r("./src/utils/fn/clone.ts"),c=r("./src/utils/error.ts"),u=r("./src/hook/invoke.ts"),l=r("./src/config/error.config.ts"),d=r("./src/services/storage/index.ts"),f="cloud.downloadFile";function _(e){return n.__awaiter(this,void 0,void 0,function(){var t=this;return n.__generator(this,function(r){return[2,new Promise(function(r,o){return n.__awaiter(t,void 0,void 0,function(){var t,u;return n.__generator(this,function(_){switch(_.label){case 0:return _.trys.push([0,2,,3]),function(e){s.assertType(e,{fileID:"string"}),e.config&&e.config.env&&s.assertType(e.config.env,"string")}(e),e.context&&(e.context.abort=function(){o(c.returnAsFinalCloudSDKError({errMsg:"abort"},f))},e.context.aborted)?[2,o(c.returnAsFinalCloudSDKError({errMsg:"abort"},f))]:[4,function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:return[4,function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,s;return n.__generator(this,function(i){switch(i.label){case 0:return t=JSON.stringify({fileid:e.fileID}),[4,a.tunnel(a.constructTunnelReq("tcbapi_downloadfile",t,n.__assign({},e.config,{serviceName:d.STORAGE_SERVICE_NAME})))];case 1:if(r=i.sent(),!(s=r.data).download_url)throw new c.CloudSDKError({errCode:l.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL,errMsg:l.ERR_CODE[l.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL]});return s.download_url.indexOf("?")>-1?s.download_url+="&skip_domain_check=true":s.download_url+="?skip_domain_check=true",[2,s.download_url]}})})}(e)];case 1:return t=r.sent(),[2,new Promise(function(r,n){if(e.context&&e.context.aborted)return n(c.returnAsFinalCloudSDKError({errMsg:"abort"},f));var a=wx.downloadFile({url:t,success:function(e){r(e)},fail:function(e){n(e)}});a.onProgressUpdate(function(){e.downloadTaskAgent&&e.context&&e.context.onProgressUpdateUserHandler&&i.isFunction(e.context.onProgressUpdateUserHandler)&&e.context.onProgressUpdateUserHandler.apply(wx.downloadFile,arguments)}),e.context&&(e.context.abort=a.abort.bind(a))})]}})})}(e)];case 1:return t=_.sent(),r(t),[3,3];case 2:return u=_.sent(),o(c.returnAsFinalCloudSDKError(u,f)),[3,3];case 3:return[2]}})})})]})})}t.default=function(e){return e=o.shallowClone(e),u.hasAPICallback(e)?function(e){var t={aborted:!1},r=function(e){return{onProgressUpdate:function(t){e.onProgressUpdateUserHandler=t},abort:function(){e.abort&&e.abort(),e.aborted=!0}}}(t);return _(n.__assign({},e,{context:t,downloadTaskAgent:r})).then(function(t){u.invokeSuccessCompleteCallbacks(f,e,t)}).catch(function(t){u.invokeFailCompleteCallbacks(f,e,t)}),r}(e):_(e)}},"./src/services/storage/api/getTempFileURL.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/network/tunnel.ts"),s=r("./src/utils/assert.ts"),i=r("./src/utils/error.ts"),o=r("./src/utils/serializer.ts"),c=r("./src/hook/invoke.ts"),u=r("./src/utils/msg.ts"),l=r("./src/utils/fn/clone.ts"),d=r("./src/utils/type.ts"),f=r("./src/config/error.config.ts"),_=r("./src/services/storage/index.ts"),p=r("./src/cloud/index.ts"),m="cloud.getTempFileURL";function E(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),function(e){if(s.assertType(e,{fileList:"array"}),e.config&&e.config.env&&s.assertType(e.config.env,"string"),p.default.appConfig.get_temp_file_url_max_requests&&e.fileList.length>p.default.appConfig.get_temp_file_url_max_requests)throw new i.CloudSDKError({errCode:f.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:"parameter.fileList exceed max length "+p.default.appConfig.get_temp_file_url_max_requests})}(e),e.fileList.length?[4,function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,s,i;return n.__generator(this,function(c){switch(c.label){case 0:return t={file_list:e.fileList.map(function(e){return d.isString(e)?{fileid:e}:{fileid:e.fileID,max_age:e.maxAge}})},r=o.serialize(t),[4,a.tunnel(a.constructTunnelReq("tcbapi_gettempfileurl",r,n.__assign({},e.config,{serviceName:_.STORAGE_SERVICE_NAME})))];case 1:return s=c.sent(),i=s.data,[2,{errMsg:u.apiSuccessMsg(m),fileList:i.download_list.map(function(e){return{fileID:e.fileid,tempFileURL:e.download_url,maxAge:e.max_age,status:e.status,errMsg:e.errmsg}})}]}})})}(e)]:[2,{errMsg:u.apiSuccessMsg(m),fileList:[]}];case 1:return[2,r.sent()];case 2:throw t=r.sent(),i.returnAsFinalCloudSDKError(t,m);case 3:return[2]}})})}t.default=function(e){return e=l.shallowClone(e),c.hasAPICallback(e)?function(e){E(e).then(function(t){c.invokeSuccessCompleteCallbacks(m,e,t)}).catch(function(t){c.invokeFailCompleteCallbacks(m,e,t)})}(e):E(e)}},"./src/services/storage/api/uploadFile.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/network/tunnel.ts"),s=r("./src/utils/assert.ts"),i=r("./src/utils/error.ts"),o=r("./src/utils/type.ts"),c=r("./src/utils/fn/clone.ts"),u=r("./src/hook/invoke.ts"),l=r("./src/utils/msg.ts"),d=r("./src/services/storage/index.ts"),f=r("./src/config/error.config.ts"),_=r("./src/cloud/index.ts"),p="cloud.uploadFile";function m(e){var t=this;return new Promise(function(r,c){return n.__awaiter(t,void 0,void 0,function(){var t,u;return n.__generator(this,function(m){switch(m.label){case 0:return m.trys.push([0,2,,3]),function(e){s.assertType(e,{cloudPath:"string",filePath:"string"}),e.config&&e.config.env&&s.assertType(e.config.env,"string")}(e),function(e){n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){return[2,new Promise(function(t,r){wx.getFileInfo({filePath:e,success:function(e){e.size>_.default.appConfig.upload_max_file_size?r(new i.CloudSDKError({errCode:f.ERR_CODE.SDK_STORAGE_EXCEED_MAX_UPLOAD_SIZE,errMsg:"exceed max upload file size: "+_.default.appConfig.upload_max_file_size/1024/1024+" MB"})):t()},fail:function(){t()}})})]})})}(e.filePath),e.context&&(e.context.abort=function(){c(i.returnAsFinalCloudSDKError({errMsg:"abort"},p))},e.context.aborted)?[2,c(i.returnAsFinalCloudSDKError({errMsg:"abort"},p))]:[4,function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(r){switch(r.label){case 0:return[4,function(e){return n.__awaiter(this,void 0,void 0,function(){var t,r,s;return n.__generator(this,function(o){switch(o.label){case 0:return t=JSON.stringify({path:e.cloudPath}),[4,a.tunnel(a.constructTunnelReq("tcbapi_uploadfile",t,n.__assign({},e.config,{serviceName:d.STORAGE_SERVICE_NAME})))];case 1:if(r=o.sent(),!(s=r.data).upload_url)throw new i.CloudSDKError({errCode:f.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL,errMsg:f.ERR_CODE[f.ERR_CODE.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL]});return s.upload_url.indexOf("?")>-1?s.upload_url+="&skip_domain_check=true":s.upload_url+="?skip_domain_check=true",[2,s.upload_url]}})})}(e)];case 1:return t=r.sent(),[2,new Promise(function(r,n){if(e.context&&e.context.aborted)return n(i.returnAsFinalCloudSDKError({errMsg:"abort"},p));var a=wx.uploadFile({url:t,filePath:e.filePath,header:e.header,name:"file",success:function(e){try{var t=JSON.parse(e.data);if(t.data&&(t=t.data),t.fileid)r({errMsg:l.apiSuccessMsg(p),fileID:t.fileid,statusCode:e.statusCode});else{var a=new i.CloudSDKError({errMsg:"empty fileid; "+t.message+";"});n(a)}}catch(a){var s=new i.CloudSDKError({errMsg:"Error parsing response data "+e.data+";"});n(s)}},fail:function(e){n(e)}});a.onProgressUpdate(function(){e.uploadTaskAgent&&e.context&&e.context.onProgressUpdateUserHandler&&o.isFunction(e.context.onProgressUpdateUserHandler)&&e.context.onProgressUpdateUserHandler.apply(wx.uploadFile,arguments)}),e.context&&(e.context.abort=a.abort.bind(a))})]}})})}(e)];case 1:return t=m.sent(),r(t),[3,3];case 2:return u=m.sent(),c(i.returnAsFinalCloudSDKError(u,p)),[3,3];case 3:return[2]}})})})}t.default=function(e){return e=c.shallowClone(e),u.hasAPICallback(e)?function(e){var t={aborted:!1},r=function(e){return{onProgressUpdate:function(t){e.onProgressUpdateUserHandler=t},abort:function(){e.abort&&e.abort(),e.aborted=!0}}}(t);return m(n.__assign({},e,{context:t,uploadTaskAgent:r})).then(function(t){u.invokeSuccessCompleteCallbacks(p,e,t)}).catch(function(t){u.invokeFailCompleteCallbacks(p,e,t)}),r}(e):m(e)}},"./src/services/storage/index.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/cloud/index.ts"),a=r("./src/services/storage/api/api.ts");function s(e){e.registerService({name:t.STORAGE_SERVICE_NAME,getAPIs:a.getAPIs})}t.STORAGE_SERVICE_NAME="storage",t.registerService=s,s(n.default)},"./src/utils/assert.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/type.ts"),a=r("./src/utils/error.ts"),s=r("./src/config/error.config.ts");function i(e,t,r){void 0===r&&(r="parameter");var a=function e(t,r,a){var s=n.getType(t),i=n.getType(r);if("string"===i)return s!==r?a+" should be "+r+" instead of "+s+";":"";if(s!==i)return a+" should be "+i+" instead of "+s+"; ";var o="";switch(s){case"object":for(var c in r)o+=e(t[c],r[c],a+"."+c);break;case"array":for(var u=0;u<r.length;u++)o+=e(t[u],r[u],a+"["+u+"]")}return o}(e,t,r);return{passed:!a,reason:a}}t.validType=i,t.assertType=function(e,t,r,n){void 0===r&&(r="parameter"),void 0===n&&(n=a.CloudSDKError);var o=i(e,t,r);if(!o.passed)throw new n({errCode:s.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR,errMsg:o.reason})},t.assertRequiredParam=function(e,t,r,n){if(void 0===n&&(n=a.CloudSDKError),void 0===e||null===e)throw new n({errCode:s.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:"parameter "+t+" of function "+r+" must be provided"})},t.assertStringLength=function(e){var t=e.name,r=e.input,n=e.max,i=e.maxWording,o=void 0===i?"":i,c=e.ErrorClass,u=void 0===c?a.CloudSDKError:c;if(r.length>n)throw new u({errCode:s.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:t+" size must be less than "+(o||n)})},t.assertObjectNotEmpty=function(e){var t=e.target,r=e.name,n=e.ErrorClass,i=void 0===n?a.CloudSDKError:n;if(0===Object.keys(t).length)throw new i({errCode:s.ERR_CODE.SDK_API_PARAMETER_ERROR,errMsg:r+" must not be empty"})}},"./src/utils/error.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/utils/type.ts"),s=r("./src/utils/msg.ts"),i=r("./src/config/error.config.ts"),o=function(e){function t(t){var r=e.call(this,t.errMsg)||this;return r.errCode=-1,Object.defineProperties(r,{message:{get:function(){return"errCode: "+this.errCode+" "+(i.ERR_CODE[this.errCode]||"")+" | errMsg: "+this.errMsg},set:function(e){this.errMsg=e}}}),r.errCode=t.errCode||-1,r.errMsg=t.errMsg,r}return n.__extends(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return"errCode: "+this.errCode+" | errMsg: "+this.errMsg},set:function(e){this.errMsg=e},enumerable:!0,configurable:!0}),t}(Error);function c(e){return e&&e instanceof Error&&a.isString(e.errMsg)}function u(e,t){if(void 0===t&&(t=""),e){if(c(e))return t&&(e.errMsg+="; "+t),e;var r=e?e.errCode:void 0,n=(e&&e.errMsg||e.toString()||"unknown error")+"; "+t;return new o({errCode:r,errMsg:n})}return new o({errMsg:t})}t.CloudSDKError=o,t.isSDKError=c,t.returnAsCloudSDKError=u,t.returnAsFinalCloudSDKError=function(e,t){if(e&&c(e))return e;var r=u(e,"at "+t+" api; ");return r.errMsg=s.apiFailMsg(t,r.errMsg),r}},"./src/utils/fail-safe.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/error.ts"),a=r("./src/utils/type.ts"),s=r("./src/externals/public-lib/reporter.ts");function i(e,t){void 0===t&&(t="");try{return e()}catch(e){if(n.isSDKError(e))return e.errMsg+=t,e;var r=(e?e.toString():"")+t;return new n.CloudSDKError({errMsg:r})}}t.tryCatch=i,t.wrapWithTryCatch=function(e,t){return void 0===t&&(t=""),function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return i(function(){return e.apply(e,r)},t)}},t.wrapParamCallbacksWithTryCatch=function(e){var t=e.param;t&&(t.success&&a.isFunction(t.success)&&(t.success=s.default.surroundThirdByTryCatch(t.success,"at api "+e.apiName+" success callback function")),t.fail&&a.isFunction(t.fail)&&(t.fail=s.default.surroundThirdByTryCatch(t.fail,"at api "+e.apiName+" fail callback function")),t.complete&&a.isFunction(t.complete)&&(t.complete=s.default.surroundThirdByTryCatch(t.complete,"at api "+e.apiName+" complete callback function")))}},"./src/utils/fn/clone.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/utils/type.ts");t.shallowClone=function(e,t){if(void 0===t&&(t=!1),t)return function(e){switch(a.getType(e)){case"object":return n.__assign({},e);case"array":return e.slice();case"number":return e instanceof Number?new Number(e):e;case"string":return e instanceof String?new String(e):e;case"boolean":return e instanceof Boolean?new Boolean(e):e;case"date":return new e.constructor(+e);case"map":return new Map(e);case"set":return new Set(e);default:return e}}(e);if(a.isPlainObject(e))return n.__assign({},e);switch(a.getType(e)){case"object":return e;case"array":return e.slice();default:return e}}},"./src/utils/msg.ts":function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.apiSuccessMsg=function(e){return e+":ok"},t.apiCancelMsg=function(e,t){return e+":cancel "+t},t.apiFailMsg=function(e,t){return e+":fail "+t}},"./src/utils/serializer.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=r("./src/utils/error.ts"),s=r("./src/config/error.config.ts"),i=r("./src/utils/type.ts");function o(e,t){if(void 0===t&&(t="data"),null!==e&&void 0!==e){if(!0===e||!1===e)return e;switch(i.getType(e)){case"number":if(isFinite(e))return e;break;case"string":return e;case"array":return e.map(function(e,r){return o(e,t+"["+r+"]")});case"object":var r={};for(var c in e)e.hasOwnProperty(c)&&(r[c]=o(e[c],t+"."+c));return r;case"arraybuffer":var u=new Uint8Array(e);return{type:"Buffer",data:n.__spread(u)}}if("function"==typeof e)return e;!function(e){throw new a.CloudSDKError({errCode:s.ERR_CODE.SDK_API_PARAMETER_TYPE_ERROR,errMsg:e+" is not JSON-serializable"})}(t)}}function c(e){switch(i.getType(e)){case"object":return function e(t){var r=t;var n=u(r);if(r!==n)return n;for(var a in r){var s=r[a],o=i.getType(s);switch(o){case"object":var l=u(s);r[a]=l!==s?l:e(r[a]);break;case"array":var l=c(s);l!==s&&(r[a]=l);break;default:continue}}return r}(e);case"array":return e.map(c);default:return e}}function u(e){for(var t in e)switch(t){case"type":switch(e.type){case"Buffer":if(i.isArray(e.data)&&i.isNumber(e.data[0]))try{return new Uint8Array(e.data).buffer}catch(t){return e}}}return e}t.serialize=function(e){var t=o(e);return JSON.stringify(t)},t.toJSONSerializable=o,t.deserialize=function(e){return c(JSON.parse(e))}},"./src/utils/symbol.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./node_modules/tslib/tslib.es6.js"),a=[],s={},i=function(e){function t(t,r){if(r!==s)throw new TypeError("InternalSymbol cannot be constructed with new operator");return e.call(this,t)||this}return n.__extends(t,e),t.for=function(e){for(var r=0,n=a.length;r<n;r++)if(a[r].target===e)return a[r].instance;var i=new t(e,s);return a.push({target:e,instance:i}),i},t}(function(){return function(e){Object.defineProperties(this,{target:{enumerable:!1,writable:!1,configurable:!1,value:e}})}}());t.InternalSymbol=i,t.default=i},"./src/utils/type.ts":function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var n=r("./src/utils/symbol.ts");t.getType=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},t.isObject=function(e){return"object"===t.getType(e)},t.isString=function(e){return"string"===t.getType(e)},t.isNumber=function(e){return"number"===t.getType(e)},t.isPromise=function(e){return"promise"===t.getType(e)},t.isFunction=function(e){return"function"==typeof e},t.isArray=function(e){return Array.isArray(e)},t.isDate=function(e){return"date"===t.getType(e)},t.isInternalObject=function(e){return e&&e._internalType instanceof n.InternalSymbol},t.isPlainObject=function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}}});