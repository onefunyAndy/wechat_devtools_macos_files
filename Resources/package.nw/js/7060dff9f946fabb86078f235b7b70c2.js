'use strict';!function(require,directRequire){function a(a,b,c){const d=c||f();if(!1!==z.md5){if(!z.libs[d]||!z.libs[d][a])return void console.warn('no vendor md5 record',d);let c=z.libs[d][a],e=q.createHash('md5');e.update(b);let f=e.digest('hex');if(c!==f){let b=new Error(`${d} ${a} ${f}!=${c}`);throw b.code=n.VENDOR_MD5_NOT_MATCH,b}}}function b(a,b){if(!1!==z.md5){let c=z[a],d=q.createHash('md5');d.update(b);let e=d.digest('hex');if(c!==e){let b=new Error(`${a} ${e}!=${c}`);throw b.code=n.VENDOR_MD5_NOT_MATCH,b}}}function c(){z=E;let a=JSON.stringify(E);j.writeFileSync(x,a),A=z.currentLibVersion,y.emit('VENDOR_VERSION_CHANGE',z)}function d(){try{for(let a in v){let b=k.join(w,a),c=j.readFileSync(k.join(D,a));v[a]?j.writeFileSync(b,c,{mode:511}):j.writeFileSync(b,c)}c()}catch(a){l.error(`copyUnVersionVendor catch error ${a}`)}}async function e(a){let b=B[a];return b?b:(b=B[a]=j.readFileSync(k.join(D,a)),j.writeFile(destFilePath,b,(a)=>{a&&l.error(`getUnVersionVendorCache writeFile error ${a}`)}),b)}function f(){return A}async function g(b,c){const d=c||f();let e=B[d];if(!e)B[d]={};else if(e[b])return e[b];let g,i=k.join(w,d),m=k.join(i,b);try{return g=B[d][b]=j.readFileSync(m),'dev'!=d&&a(b,g,c),g}catch(a){l.error(`getVersionVendorCache catch error ${a}`)}o.sync(i);try{let a=k.join(D,d,b);return g=B[d][b]=j.readFileSync(a,'utf8'),j.writeFile(m,g,(a)=>{a&&l.error(`getVersionVendorCache writeFile ${d}/${b} error ${a}`)}),g}catch(a){l.error(`getVersionVendorCache from install package catch error ${a}`)}let n=`https://dldir1.qq.com/WechatWebDev/vendor/${d}/${b}`;return g=B[d][b]=await h(n),j.writeFile(m,g,(a)=>{l.error(`getVersionVendorCache writeFile ${d}/${b} error ${a}`)}),g}async function h(a){let b=await p({url:a,needToken:-1,needParse:-1});return b.body}function i(a){if(B[a])return B[a];let d=u?a:`${a}.exe`;if(t&&!nw.App.manifest.forceVendor)return B[a]=k.join(D,d),B[a];let e=k.join(w,d);if(j.existsSync(e))try{return b(d,j.readFileSync(e)),B[a]=e,e}catch(a){l.error(`getParsePath catch error ${a}`)}if(e=k.join(D,d),!j.existsSync(e)){let b=new Error(`${a} file not found in install package`);throw b.code='wcc'==a?n.VENDOR_WCC_FILE_NOT_FOUND:n.VENDOR_WCSC_FILE_NOT_FOUND,b}B[a]=e;try{j.writeFileSync(k.join(w,d),j.readFileSync(e),{mode:511}),c()}catch(a){}return e}const j=require('fs'),k=require('path'),l=require('./72653d4b93cdd7443296229431a7aa9a.js'),m=require('./92320c1386e6db6a6f2556736a9bc280.js'),n=require('./949d8235c744ced2a80121e4dba34c28.js'),o=require('mkdir-p'),p=require('./15ba1827c7f6564a45df6bd44da3a977.js'),q=require('crypto'),r=require('events').EventEmitter,s=require('./b15113dd543cbfb6f4172e5f5fa6563e.js'),t=global.appConfig.isDev,u='darwin'===process.platform;let v=u?{wcc:!0,wcsc:!0,DevToolProtector:!0}:{"wcc.exe":!0,"wcsc.exe":!0};v=Object.assign(v,{"hls.js":!1,"WARemoteDebug.js":!1,"devtools-native-components.js":!1});const w=m.WeappVendor,x=k.join(w,'config.json'),y=new r;let z,A,B={};const C=k.join(__dirname,'../../vendor/dev'),D=t?k.join(__dirname,'../../vendor/'):k.join(__dirname,'./vendor/'),E=JSON.parse(j.readFileSync(k.join(D,'config.json'),'utf8'));(function(){try{if(z=JSON.parse(j.readFileSync(x,'utf8')),z.configVersion>=E.configVersion)return void(A=z.currentLibVersion)}catch(a){l.error(`init catch error ${a}`)}d()})(),module.exports={on:function(a,b){y.on(a,b)},off:function(a,b){y.removeListener(a,b)},getFile:async function(a,b){return b||!t||nw.App.manifest.forceVendor?!b&&v.hasOwnProperty(a)?e(a):g(a,b):j.readFileSync(k.join(C,a),'utf8')},setVersion:function(a){return z.libs[a]?A!=a&&(A=a,y.emit('VENDOR_VERSION_CHANGE',a)):A!=z.currentLibVersion&&(A=z.currentLibVersion,y.emit('VENDOR_VERSION_CHANGE',a)),A},getVersion:function(){return A},getVendorConfig:function(){return z||E},getWXMLParsePath:function(){return i('wcc')},getWXSSParsePath:function(){return i('wcsc')},getFixpreferencesPath:function(){if(!u)return;if(B.DevToolProtector)return B.DevToolProtector;let a='DevToolProtector';if(t)return B.DevToolProtector=k.join(D,a),B.DevToolProtector;let b=k.join(w,a);if(!j.existsSync(b)&&(b=k.join(D,a),!j.existsSync(b))){let a=new Error('DevToolProtector file not found in install package');throw a.code=n.VENDOR_WCC_FILE_NOT_FOUND,a}return B.DevToolProtector=b,b},updateVendorConfig:async function(a){try{if(a=JSON.parse(a.vendor),a.version>z.configVersion){let b=await p({url:a.url,needToken:0}),c=b.body;z.configVersion<c.configVersion&&(z=c,j.writeFileSync(x,JSON.stringify(z)),y.emit('VENDOR_CONFIG_CHANGE',z),l.info(`updateVendorConfig end get new vendorConfig ${JSON.stringify(z)}`))}}catch(a){l.error(`updateVendorConfig catch error ${a}`)}return z}}}(require('lazyload'),require);