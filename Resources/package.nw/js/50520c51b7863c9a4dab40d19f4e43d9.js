'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(require,directRequire){async function a(a,b=()=>{}){return new Promise(async(d,e)=>{try{const e=Date.now(),f=[...a];b('compilejs',h.config.PROCESSING.format(a[0].file));const i=await Promise.all(a.map((a)=>g({taskName:'processJS',config:{projectPath:a.projectPath,file:a.file,es6:a.es6?'yes':'no',minified:a.minified?'yes':'no',sourceMaps:'map',uglifyFileName:a.uglifyFileName?'yes':'no',nameMapping:JSON.stringify(a.nameMapping),sourceFileName:c.basename(a.file)},dataStr:a.code,maxTimeout:180000,useBackup:!0,downgrade:!1,showInStatus:{text:`compiling ${a.file}`},onAfterRun:()=>{const c=f.findIndex((b)=>b===a);0<=c&&f.splice(c,1),f[0]&&b('compilejs',h.config.PROCESSING.format(f[0].file))}})));console.log(`compilejs all files cost time: ${Date.now()-e}`),d(i)}catch(a){a instanceof Error?e(a):e(new Error(a))}})}const b=require('fs'),c=require('path'),d=require('mkdir-p'),e=require('./162bf2ee28b76d3b3d95b685cede4146.js'),f=require('./48679210e49dc5028a8b6642263eba75.js'),g=require('./41168dca39589e852da6631126d0f94d.js'),h=require('./common/locales/index.js'),i=require('./cdbf7243dc99f8461acbb1d57af1d8ae.js'),j=require('./84b183688a46c9e2626d3e6f83365e13.js'),k=require('./f171257bbcaef547a3cf27266ccb0db2.js'),l=require('./15ba1827c7f6564a45df6bd44da3a977.js'),m=require('./72653d4b93cdd7443296229431a7aa9a.js'),n=require('./1c8a8c710417d102ab574145dc51b4b0.js'),{bufToUTF8:o}=require('./efc820e1b92d6e4063535296d4a24213.js'),{FILE_NOT_UTF8:p}=require('./949d8235c744ced2a80121e4dba34c28.js'),q={},r={};module.exports=function(g,k={}){q[g.hash]||(q[g.hash]={});const l=q[g.hash],m=k.onProgressUpdate||function(){},r=k.onFilesIgnored||function(){};return new Promise(async(q,s)=>{const{es6:u,minified:v}=g.setting,w=!1,t=await f(g),x=t.openDataContext||t.subContext,{distPath:y}=k,z=await e(g),A=(g.packOptions||{}).ignore||[],B=z.getAllJSFiles().filter((a)=>!n.isFileIgnored(a,A));let C={};const D=[],E=[];for(let a=0,b=B.length;a<b;a++){const b=B[a],d=x&&0===b.indexOf(x),e=c.normalize(b.replace(/\.js$/,'')),f=z.getFile(b,null),g=o(f);if(void 0===g){const a=new Error(h.config.FILE_NOT_UTF8.format(b));return a.code=p,s(a)}const k=Date.now(),m=j.generateMD5(g),n=`${b}_${u}_${v}_${w}`;if(l[n]&&l[n].md5===m)console.log('compile js',b,'in cache, skip.');else if((u||v)&&512000>g.length)D.push({projectPath:z.srcPath,file:b,code:g,es6:u,minified:v,md5:m,uglifyFileName:w,nameMapping:C});else{let a,d=i(c.join(z.srcPath,b),g);if(d)try{'string'==typeof d&&(d=JSON.parse(d)),d=await i.insertSourcesContent(d,c.join(z.srcPath,b)),d=await i.rewriteSourcesIfNeeded(d,'game:///',[b]),a=JSON.stringify(d)}catch(a){d=null}l[n]={md5:m,jsCode:g,map:a||JSON.stringify(d),ignored:(u||v)&&512000<=g.length}}}if(0<D.length){let b=[];try{b=await a(D,m)}catch(a){return s(a)}for(let a=0,d=D.length;a<d;a++){if(b[a].error){const c=b[a].error,d=new Error(c.message);return d.code=c.code,s(d)}const{file:d,md5:e}=D[a];let f=b[a].map;try{'string'==typeof f&&(f=JSON.parse(f)),f=await i.insertSourcesContent(f,c.join(z.srcPath,d)),f=await i.rewriteSourcesIfNeeded(f,'game:///',[d]),f=JSON.stringify(f)}catch(a){f=null}l[`${d}_${u}_${v}_${w}`]={md5:e,jsCode:b[a].code,map:f}}}for(let a=0,e=B.length;a<e;a++){const e=B[a],f=e,g=c.join(y,f),h=c.dirname(g);d.sync(h);const i=l[`${e}_${u}_${v}_${w}`];if(i&&i.jsCode){const a=i.jsCode;b.writeFileSync(g,a),i.ignored&&E.push(e),i.map&&b.writeFileSync(c.join(y,`${f}.map`),i.map)}}r(E),q()})}}(require('lazyload'),require);