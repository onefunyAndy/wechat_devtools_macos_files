'use strict';!function(require,directRequire){function a(a,b){return function(...c){if(c.length){const a=c.pop();'function'!=typeof a&&c.push(a)}return new Promise(function(d,e){c.push(function(a,b){a?e(a):d(b)}),a.apply(b||null,c)})}}function b(){return++E}function c(){v.start_time=Date.now(),w.forEach((a)=>v[a]=0===a.indexOf('extra')?'':0)}function d(){v.pack_time=Date.now()-v.start_time;const a={};w.forEach((b)=>a[b]=v[b]);try{const b=s.getState().project.current.appid;t('npm_info_report',b,JSON.stringify(a))}catch(a){}}async function e(a){const b=n.dirname(a);try{await B(b)}catch(a){await e(b)}try{await B(a);const b=await x(a);b&&!b.isDirectory()&&(await C(a,`${a}.bak`),console.warn(`${a} already exists but is not a directory, so it will be rename to a file with the suffix ending in '.bak'`),await y(a))}catch(b){await y(a)}}async function f(a,b){const c=await z(a);await g(c,b)}async function g(a,b){await e(n.dirname(b)),await A(b,a)}function h(a,b){b(a),Object.keys(a).forEach((c)=>{const d=a[c];Array.isArray(d)&&d.forEach((a)=>{a&&a.type&&h(a,b)}),d&&d.type&&h(d,b)})}function i(a,b,c){let d=q.parse(a,{sourceType:'module',locations:!0});const e=[];let f=[];return h(d,(d)=>{const g=d.callee,h=d.arguments;if('CallExpression'===d.type&&g&&'Identifier'===g.type&&'require'===g.name&&h&&1===h.length&&('Literal'===h[0].type?e.push(h[0].value):(c.push({jsPath:b,code:a.substring(d.start,d.end),startLine:d.loc.start.line,endLine:d.loc.end.line,tips:'require variable is not allowed',msg:u.config.NOT_ALLOWED_REQUIRE_VAR}),v.warn_require_var_num++)),'ImportDeclaration'===d.type){const a=d.source,b=d.specifiers,c={start:d.start,end:d.end},g=[];a&&'Literal'===a.type&&(e.push(a.value),g.push(`var __TEMP__ = require('${a.value}');`)),b&&Array.isArray(b)&&b.forEach((a)=>{if('ImportSpecifier'===a.type){const b=a.local,c=a.imported;'Identifier'===b.type&&'Identifier'===c.type&&g.push(`var ${b.name} = __TEMP__['${c.name}'];`)}else if('ImportDefaultSpecifier'===a.type){const b=a.local;'Identifier'===b.type&&g.push(`var ${b.name} = __REQUIRE_DEFAULT__(__TEMP__);`)}else if('ImportNamespaceSpecifier'===a.type){const b=a.local;'Identifier'===b.type&&g.push(`var ${b.name} = __REQUIRE_WILDCARD__(__TEMP__);`)}}),c.adjustContent=g.join(''),f.push(c)}if('ExportNamedDeclaration'===d.type){const b=d.source,c=d.specifiers,g=d.declaration;let h=!1;const i={start:d.start,end:d.end},j=['if (!exports.__esModule) Object.defineProperty(exports, "__esModule", { value: true });'];if(b&&'Literal'===b.type&&(e.push(b.value),j.push(`var __TEMP__ = require('${b.value}');`),h=!0),!g);else if('VariableDeclaration'===g.type){const b=g.declarations;b&&Array.isArray(b)&&b.forEach((b)=>{if('VariableDeclarator'===b.type){const c=b.id,d=b.init;c&&'Identifier'===c.type&&(i.notAddLines=!0,j.push(`var ${c.name} = exports.${c.name} = ${d?a.substring(d.start,d.end):'undefined'};`))}})}else if('FunctionDeclaration'===g.type){const b=g.id;b&&'Identifier'===b.type&&(i.notAddLines=!0,j.push(`exports.${b.name} = ${a.substring(g.start,g.end)};`))}else if('ClassDeclaration'===g.type){const b=g.id;b&&'Identifier'===b.type&&(i.notAddLines=!0,j.push(`exports.${b.name} = ${a.substring(g.start,g.end)};`))}c&&Array.isArray(c)&&c.forEach((a)=>{if('ExportSpecifier'===a.type){const b=a.local,c=a.exported;'Identifier'===b.type&&'Identifier'===c.type&&j.push(`Object.defineProperty(exports, '${c.name}', { enumerable: true, get: function() { return ${h?'__TEMP__.':''}${b.name}; } });`)}}),i.adjustContent=j.join(''),f.push(i)}else if('ExportAllDeclaration'===d.type){const a=d.source,b={start:d.start,end:d.end},c=['if (!exports.__esModule) Object.defineProperty(exports, "__esModule", { value: true });'];a&&'Literal'===a.type&&(e.push(a.value),c.push(`var __TEMP__ = require('${a.value}');`)),c.push('Object.keys(__TEMP__).forEach(function(k) { if (k === "default" || k === "__esModule") return; Object.defineProperty(exports, k, { enumerable: true, get: function() { return __TEMP__[k]; } }); });'),b.adjustContent=c.join(''),f.push(b)}else if('ExportDefaultDeclaration'===d.type){const b=d.declaration,c={start:d.start,end:d.end},e=['if (!exports.__esModule) Object.defineProperty(exports, "__esModule", { value: true });'];b&&(c.notAddLines=!0,e.push(`exports.default = ${a.substring(b.start,b.end)};`)),c.adjustContent=e.join(''),f.push(c)}const i=d.expression;'ExpressionStatement'===d.type&&i&&'AssignmentExpression'===i.type&&'Identifier'===i.right.type&&'require'===i.right.name&&(c.push({jsPath:b,code:a.substring(d.start,d.end),startLine:d.loc.start.line,endLine:d.loc.end.line,tips:'assign require function to a variable is not allowed',msg:u.config.NOT_ALLOWED_REQUIRE_ASSIGN}),v.warn_require_rename_num++);const j=d.declarations;'VariableDeclaration'===d.type&&0<j.length&&j.forEach((e)=>{const f=e.init;'VariableDeclarator'===e.type&&f&&'Identifier'===f.type&&'require'===f.name&&(c.push({jsPath:b,code:a.substring(d.start,d.end),startLine:d.loc.start.line,endLine:d.loc.end.line,tips:'assign require function to a variable is not allowed',msg:u.config.NOT_ALLOWED_REQUIRE_ASSIGN}),v.warn_require_rename_num++)})}),f=f.sort((c,a)=>a.start-c.start),f.forEach((b)=>{const c=a.substring(b.start,b.end),d=b.notAddLines?0:c.split('\n').length;a=a.substring(0,b.start)+b.adjustContent+Array(d).join('\n')+a.substring(b.end)}),{deps:e,parsedContent:a}}async function j(a,c,d,e,f,g){if(c=n.normalize(c),f[c])return f[c];const h=await z(c,'utf8'),k=b(),l=n.relative(d,c);if(/\.json$/.test(c)){const a={id:k,name:l,content:`module.exports = ${h}`,deps:[],depsMap:{}};f[c]=k,e.push(a)}else{const{deps:b,parsedContent:m}=i(h,c,g),o={id:k,name:l,content:m,deps:b,depsMap:{}};f[c]=k,e.push(o);for(const h of b){let b,i=n.join(n.dirname(c),h);try{const a=await x(i);a&&a.isDirectory()&&(i=n.join(i,'index.js'))}catch(a){}/\.js$/.test(i)||/\.json$/.test(i)||(i+='.js');try{await B(i),b=await j(a,i,d,e,f,g)}catch(a){}b&&(o.depsMap[h]=b)}}return k}function k(a,b,c,d){const e=b.split('\n').length;for(let f=1;f<=e;f++)a.addMapping({generated:{line:d+f,column:0},original:{line:f,column:0},source:c})}async function l(a,b,c){try{const b=await x(a);b&&b.isDirectory()&&(a=n.join(a,'index.js'))}catch(a){}/\.js$/.test(a)||/\.json$/.test(a)||(a+='.js');try{await B(a)}catch(b){return c.push({jsPath:a,code:'',tips:'entry file is not found',msg:u.config.NOT_FOUND_NPM_ENTRY}),void v.warn_not_found_num++}const d=new r.SourceMapGenerator({file:'index.js'}),e=[];await j(n.dirname(a),a,b,e,{},c);const f=['module.exports = (function() {','var __MODS__ = {};','var __DEFINE__ = function(modId, func, req) { var m = { exports: {} }; __MODS__[modId] = { status: 0, func: func, req: req, m: m }; };','var __REQUIRE__ = function(modId, source) { if(!__MODS__[modId]) return require(source); if(!__MODS__[modId].status) { var m = { exports: {} }; __MODS__[modId].status = 1; __MODS__[modId].func(__MODS__[modId].req, m, m.exports); if(typeof m.exports === "object") { Object.keys(m.exports).forEach(function(k) { __MODS__[modId].m.exports[k] = m.exports[k]; }); if(m.exports.__esModule) Object.defineProperty(__MODS__[modId].m.exports, "__esModule", { value: true }); } else { __MODS__[modId].m.exports = m.exports; } } return __MODS__[modId].m.exports; };','var __REQUIRE_WILDCARD__ = function(obj) { if(obj && obj.__esModule) { return obj; } else { var newObj = {}; if(obj != null) { for(var k in obj) { if (Object.prototype.hasOwnProperty.call(obj, k)) newObj[k] = obj[k]; } } newObj.default = obj; return newObj; } };','var __REQUIRE_DEFAULT__ = function(obj) { return obj && obj.__esModule ? obj.default : obj; };'];if(e.length){const a=e.shift();f.push(`__DEFINE__(${a.id}, function(require, module, exports) {`),k(d,a.content,a.name,f.length),f.push(a.content),f.push(`}, function(modId) {var map = ${JSON.stringify(a.depsMap)}; return __REQUIRE__(map[modId], modId); })`);for(const a of e)f.push(`__DEFINE__(${a.id}, function(require, module, exports) {`),k(d,a.content,a.name,f.length),f.push(a.content),f.push(`}, function(modId) { var map = ${JSON.stringify(a.depsMap)}; return __REQUIRE__(map[modId], modId); })`);f.push(`return __REQUIRE__(${a.id});`)}return f.push('})()'),f.push('//# sourceMappingURL=index.js.map'),{js:f.join('\n'),map:d.toString()}}async function m(a,b){let c='miniprogram_dist';b.miniprogram&&'string'==typeof b.miniprogram&&(c=b.miniprogram);try{const b=n.join(a,c);await B(b);const d=await x(b);if(d&&d.isDirectory())return b}catch(a){}return''}const n=require('path'),o=require('fs'),p=require('glob'),q=require('acorn'),r=require('source-map'),s=require('./bc78839ccca8df9e5ceeb7fae11b7be2.js'),t=require('./da7c31daaf542cf1796023d8e344b98a.js'),u=require('./common/locales/index.js'),v={start_time:Date.now(),pack_time:0,miniprogram_pack_num:0,other_pack_num:0,warn_not_found_num:0,warn_require_var_num:0,warn_require_rename_num:0,extra1:'',extra2:'',extra3:''},w=['pack_time','miniprogram_pack_num','other_pack_num','warn_not_found_num','warn_require_var_num','warn_require_rename_num','extra1','extra2','extra3'],x=a(o.stat),y=a(o.mkdir),z=a(o.readFile),A=a(o.writeFile),B=a(o.access),C=a(o.rename),D=a(p);let E=+new Date;module.exports=async function(a,b={}){c();const e=[],h=await D('**/node_modules/**/package.json',{cwd:a,nodir:!0,dot:!0,ignore:b.ignore||[]});if(!h||!h.length)return d(),null;for(const c of h){const b=n.join(a,c);let d=await z(b,'utf8');const h=n.dirname(b),i=h.replace(/([\b\/\\])node_modules([\b\/\\])/g,(a,b,c)=>`${b}miniprogram_npm${c}`);d=JSON.parse(d);const j=n.join(h,d.main||'index.js'),k=await m(h,d);if(k){const a=await D('**/*',{cwd:k,nodir:!0,dot:!0,ignore:'**/node_modules/**'});for(const b of a)await f(n.join(k,b),n.join(i,b));v.miniprogram_pack_num++}else{const a=await l(j,i,e);if(!a)continue;await g(a.js,n.join(i,'./index.js')),await g(a.map,n.join(i,'./index.js.map')),v.other_pack_num++}}return d(),e}}(require('lazyload'),require);